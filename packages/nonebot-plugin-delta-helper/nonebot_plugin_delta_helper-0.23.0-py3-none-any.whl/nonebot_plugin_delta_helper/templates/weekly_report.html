{% extends "base.html" %}

{% block extra_styles %}
.chart-container {
    margin: 16px 0;
}

.chart-bar {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
}

.chart-label {
    width: 80px;
    font-size: 14px;
    color: #666;
}

.chart-value {
    flex: 1;
    background-color: #e5e7eb;
    height: 24px;
    border-radius: 4px;
    overflow: hidden;
    position: relative;
    margin-right: 8px;
}

.chart-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    min-width: 2px;
}

.chart-text {
    color: #333;
    font-size: 12px;
    font-weight: 500;
    white-space: nowrap;
    min-width: 40px;
    text-align: right;
}

.line-chart-container {
    margin: 16px 0;
    padding: 24px 16px 16px 16px;
}

.line-chart {
    position: relative;
    height: 120px;
    margin: 16px 0;
}

.chart-line {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
}

.chart-svg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

.chart-line-path {
    fill: none;
    stroke: #667eea;
    stroke-width: 3;
    stroke-linecap: round;
    stroke-linejoin: round;
}

.chart-point {
    position: absolute;
    width: 10px;
    height: 10px;
    background-color: #667eea;
    border: 3px solid white;
    border-radius: 50%;
    transform: translate(-50%, -50%);
    box-shadow: 0 3px 6px rgba(0,0,0,0.15);
    z-index: 2;
}

.chart-x-axis {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    margin-top: 12px;
    font-size: 12px;
    color: #666;
}

.chart-x-axis span {
    text-align: center;
}

.price-label {
    position: absolute;
    background-color: rgba(102, 126, 234, 0.95);
    color: white;
    padding: 3px 6px;
    border-radius: 4px;
    font-size: 10px;
    white-space: nowrap;
    transform: translate(-50%, -140%);
    font-weight: 500;
    z-index: 3;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <div class="card-icon">ğŸ“ˆ</div>
        <div>
            <h2 class="card-title">{{ user_name }}</h2>
            <p class="card-subtitle">ä¸‰è§’æ´²å‘¨æŠ¥ - {{ statDate_str }}</p>
        </div>
    </div>
    
    <div class="card-content">
        <!-- è´¢åŠ¡ç»Ÿè®¡ -->
        <div style="margin-bottom: 24px;">
            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #333;">èµ„äº§ç»Ÿè®¡</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">æ€»å¸¦å‡º</div>
                    <div class="stat-value success">{{ Gained_Price_Str }}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">æ€»å¸¦å…¥</div>
                    <div class="stat-value danger">{{ consume_Price_Str }}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">èµ„äº§å‡€å¢</div>
                    <div class="stat-value {% if rise_price >= 0 %}success{% else %}danger{% endif %}">{{ rise_Price_Str }}</div>
                </div>
            </div>
        </div>
        
        <!-- èµ„äº§å˜åŒ–è¶‹åŠ¿ -->
        {% if chart_data %}
        <div style="margin-bottom: 24px;">
            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #333;">èµ„äº§å˜åŒ–è¶‹åŠ¿</h3>
            <div class="line-chart-container">
                <div class="line-chart">
                    <!-- SVGæŠ˜çº¿ -->
                    <svg class="chart-svg" viewBox="0 0 400 100" preserveAspectRatio="none">
                        {% if chart_data|length > 1 %}
                        <path class="chart-line-path" d="M {% for point in chart_data %}{{ point.svg_x|round(1) }} {{ point.svg_y|round(1) }}{% if not loop.last %} L {% endif %}{% endfor %}" vector-effect="non-scaling-stroke"></path>
                        {% endif %}
                    </svg>
                    <!-- æ•°æ®ç‚¹å’Œæ ‡ç­¾ -->
                    <div class="chart-line">
                        {% for point in chart_data %}
                        <div class="chart-point" style="left: {{ point.x_position }}%; top: {{ point.height }}%;">
                            <div class="price-label">{{ point.display_price }}</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="chart-x-axis">
                    {% for point in chart_data %}
                    <span>{{ point.day }}</span>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- æˆ˜æ–—ç»Ÿè®¡ -->
        <div style="margin-bottom: 24px;">
            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #333;">æˆ˜æ–—ç»Ÿè®¡</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">æ€»åœºæ¬¡</div>
                    <div class="stat-value">{{ total_sol_num }}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">åœ¨çº¿æ—¶é•¿</div>
                    <div class="stat-value">{{ online_time }}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">K/D</div>
                    <div class="stat-value">{{ total_kill }}/{{ total_death }}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">æ’¤ç¦»æ•°</div>
                    <div class="stat-value">{{ total_exacuation_num }}</div>
                </div>
            </div>
        </div>
        
        <!-- ç‰¹æ®Šæˆå°± -->
        <div style="margin-bottom: 24px;">
            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #333;">ç‰¹æ®Šæˆå°±</h3>
            <div class="info-row">
                <span class="info-label">ç™¾ä¸‡æ’¤ç¦»</span>
                <span class="badge badge-success">{{ million_gained }}æ¬¡</span>
            </div>
        </div>
        
        <!-- å¹²å‘˜ä½¿ç”¨ç»Ÿè®¡ -->
        {% if armed_forces %}
        <div style="margin-bottom: 24px;">
            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #333;">å¹²å‘˜ä½¿ç”¨</h3>
            <div class="chart-container">
                {% for force in armed_forces %}
                <div class="chart-bar">
                    <div class="chart-label">{{ force.name }}</div>
                    <div class="chart-value">
                        <div class="chart-fill" style="width: {{ force.percentage }}%;"></div>
                    </div>
                    <span class="chart-text">{{ force.count }}æ¬¡</span>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        <!-- åœ°å›¾æ¸¸ç©ç»Ÿè®¡ -->
        {% if maps %}
        <div>
            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #333;">åœ°å›¾æ¸¸ç©</h3>
            <div class="chart-container">
                {% for map in maps %}
                <div class="chart-bar">
                    <div class="chart-label" style="width: 120px;">{{ map.name }}</div>
                    <div class="chart-value">
                        <div class="chart-fill" style="width: {{ map.percentage }}%;"></div>
                    </div>
                    <span class="chart-text">{{ map.count }}æ¬¡</span>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        <!-- é˜Ÿå‹åä½œä¿¡æ¯ -->
        {% if friend_list %}
        <div>
            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 8px; color: #333;">é˜Ÿå‹åä½œæƒ…å†µ</h3>
            <p style="font-size: 12px; color: #666; margin-bottom: 16px;">æ³¨ï¼šKDä¸ºå¥½å‹KDï¼Œå¸¦å‡ºå’Œå¸¦å…¥ä¸ºæœ¬äººçš„æ•°æ®</p>
            {% for friend in friend_list %}
            <div style="background-color: #f8f9fa; border-radius: 8px; padding: 12px; margin-bottom: 12px; border-left: 4px solid #667eea;">
                <div style="font-weight: 600; color: #333; margin-bottom: 8px;">{{ friend.charac_name }}</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 12px;">
                    <div>
                        <span style="color: #666;">æ€»è§ˆï¼š</span>
                        <span style="color: #333;">{{ friend.sol_num }}åœº | {{ friend.escape_num }}æ’¤ç¦»/{{ friend.fail_num }}å¤±è´¥</span>
                    </div>
                    <div>
                        <span style="color: #666;">K/Dï¼š</span>
                        <span style="color: #333;">{{ friend.kill_num }}æ€/{{ friend.death_num }}æ­»</span>
                    </div>
                    <div>
                        <span style="color: #666;">å¸¦å‡ºï¼š</span>
                        <span style="color: #16a085;">{{ friend.gained_str }}</span>
                    </div>
                    <div>
                        <span style="color: #666;">æˆ˜æŸï¼š</span>
                        <span style="color: #e74c3c;">{{ friend.consume_str }}</span>
                    </div>
                </div>
                <div style="margin-top: 8px; font-size: 12px;">
                    <span style="color: #666;">åˆ©æ¶¦ï¼š</span>
                    <span style="color: {% if friend.profit_str.startswith('-') %}#e74c3c{% else %}#16a085{% endif %}; font-weight: 500;">{{ friend.profit_str }}</span>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    
</div>
 
{% endblock %}