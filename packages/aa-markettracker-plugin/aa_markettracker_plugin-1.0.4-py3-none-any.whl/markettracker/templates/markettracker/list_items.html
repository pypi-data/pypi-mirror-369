{% extends "markettracker/base.html" %}
{% load i18n %}

{% block header_nav_collapse_right %}
    {{ block.super }}
    <form method="get" action="{% url 'markettracker:character_login_list' %}">
        <button type="submit" class="btn btn-success">{% trans "Log in with your character" %}</button>
    </form>
{% endblock %}

{% block content %}
<h2>{% trans "Tracked market" %} – {{ region }}</h2>

<div class="card mt-3">
  <div class="card-header d-flex justify-content-between align-items-center">
    <strong>{% trans "Tracked Items" %}</strong>
    <form method="get" class="d-flex gap-2 mb-0">
      <input type="text" name="q" value="{{ q }}" class="form-control form-control-sm" placeholder="{% trans 'Search item...' %}">
      <button class="btn btn-primary btn-sm" type="submit">{% trans "Search" %}</button>
      <a href="?add=1" class="btn btn-success btn-sm">{% trans "Add" %}</a>
    </form>
  </div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-striped mb-0 w-100">
    <thead>
        <tr>
            <th>{% trans "Icon" %}</th>
            <th>{% trans "Item Name" %}</th>
            <th>{% trans "Quantity (current / desired)" %}</th>
            <th>{% trans "Minimum Price" %}</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for entry in items %}
            <tr class="{% if entry.status == 'RED' %}table-danger{% elif entry.status == 'YELLOW' %}table-warning{% endif %}">
                <td><img src="https://images.evetech.net/types/{{ entry.item.id }}/icon?size=32"></td>
                <td>{{ entry.item.name }}</td>
                <td>{{ entry.volume_remain|default:"0" }} / {{ entry.desired_quantity|default:"—" }}</td>
                <td>{% if entry.price %}{{ entry.price|floatformat:2 }} ISK{% else %}<span class="text-muted">{% trans "No data" %}</span>{% endif %}</td>
                <td class="text-end">
                    <a href="{% url 'markettracker:create_delivery' entry.item.id %}" class="btn btn-primary btn-sm">
                        <i class="fa fa-truck"></i> {% trans "Deliver" %}
                    </a>
                </td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="4">{% trans "No items to display." %}</td>
            </tr>
        {% endfor %}
    </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
