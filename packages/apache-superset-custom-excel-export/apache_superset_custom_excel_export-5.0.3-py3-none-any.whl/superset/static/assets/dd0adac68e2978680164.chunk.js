"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[5306],{82212:(e,t,n)=>{n.r(t),n.d(t,{default:()=>J});var a=n(2445),i=n(96540),l=n(16844),o=n(95579),s=n(35742),r=n(97470),d=n(56914),c=n(27395),h=n(28392),m=n(15757),u=n(83197),p=n(52879),y=n(58561),g=n.n(y),b=n(50500),_=n(30703),f=n(5261),S=n(1208),w=n(51713),v=n(4780),Y=n(44344),T=n(17437),A=n(38380),k=n(84335),C=n(15509),D=n(29221),O=n(17355),F=n(52219),z=n(56443),x=n(64658);const N=l.I4.div`
  ${({theme:e})=>T.AH`
    .ace_editor {
      border-radius: ${e.borderRadius}px;
    }
  `}
`,j=l.I4.div`
  ${({theme:e})=>T.AH`
    --ant-form-item-margin-bottom: ${6*e.sizeUnit}px;

    .system-theme-notice {
      font-size: ${e.fontSizeSM}px;
      font-style: italic;
      margin-bottom: ${4*e.sizeUnit}px;
      display: block;
    }

    .alert-info {
      margin-bottom: ${4*e.sizeUnit}px;
    }

    .apply-button-container {
      margin-top: ${2*e.sizeUnit}px;
      text-align: right;
    }
  `}
`,H=(0,f.Ay)((({addDangerToast:e,addSuccessToast:t,onThemeAdd:n,onThemeApply:s,onHide:d,show:c,theme:h=null,canDevelop:u=!1})=>{const p=(0,l.DP)(),{setTemporaryTheme:y}=(0,S.w)(),[g,_]=(0,i.useState)(!0),[f,w]=(0,i.useState)(null),[v,Y]=(0,i.useState)(!0),H=null!==h,$=!0===(null==f?void 0:f.is_system),E=$,I=u,J=(0,z.p)(null==f?void 0:f.json_data,{enabled:!E,errorPrefix:"Invalid JSON syntax"}),{state:{loading:U,resource:B},fetchResource:M,createResource:P,updateResource:R}=(0,b.fn)("theme",(0,o.t)("theme"),e),L=()=>{d(),w(null)},q=()=>{if(H){if(null!=f&&f.id){const e=f.id;delete f.id,delete f.created_by,delete f.changed_by,delete f.changed_on_delta_humanized,R(e,f).then((e=>{e&&(n&&n(),L())}))}}else f&&P(f).then((e=>{e&&(n&&n(),L())}))},K=e=>{if(!e)return!1;try{return JSON.parse(e),!0}catch(e){return!1}};return(0,i.useEffect)((()=>{H&&(null==f||!f.id||h&&(null==h?void 0:h.id)!==f.id||v&&c)?null!=h&&h.id&&!U&&M(h.id):!H&&(!f||f.id||v&&c)&&w({theme_name:"",json_data:JSON.stringify({},null,2)})}),[h,c]),(0,i.useEffect)((()=>{B&&w(B)}),[B]),(0,i.useEffect)((()=>{var e;E?_(!0):null!=f&&f.theme_name.length&&null!=f&&null!=(e=f.json_data)&&e.length&&K(f.json_data)?_(!1):_(!0)}),[f?f.theme_name:"",f?f.json_data:"",E]),v&&c&&Y(!1),(0,a.Y)(k.aF,{disablePrimaryButton:E||g,onHandledPrimaryAction:E?void 0:q,onHide:L,primaryButtonName:H?(0,o.t)("Save"):(0,o.t)("Add"),show:c,width:"55%",footer:[(0,a.Y)(C.$,{onClick:L,buttonStyle:"secondary",children:E?(0,o.t)("Close"):(0,o.t)("Cancel")},"cancel"),...E?[]:[(0,a.Y)(C.$,{onClick:q,disabled:g,buttonStyle:"primary",children:H?(0,o.t)("Save"):(0,o.t)("Add")},"save")]],title:(0,a.FD)(x.o.Title,{level:4,"data-test":"theme-modal-title",children:[H?(0,a.Y)(A.F.EditOutlined,{iconSize:"l",css:T.AH`
                margin: auto ${2*p.sizeUnit}px auto 0;
              `}):(0,a.Y)(A.F.PlusOutlined,{iconSize:"l",css:T.AH`
                margin: auto ${2*p.sizeUnit}px auto 0;
              `}),H?E?(0,o.t)("View theme properties"):(0,o.t)("Edit theme properties"):(0,o.t)("Add theme")]}),children:(0,a.Y)(j,{children:(0,a.FD)(D.l,{layout:"vertical",children:[$&&(0,a.Y)(x.o.Text,{type:"secondary",className:"system-theme-notice",children:(0,o.t)("System Theme - Read Only")}),(0,a.Y)(D.l.Item,{label:(0,o.t)("Name"),required:!E,children:(0,a.Y)(O.A,{name:"theme_name",onChange:e=>{const{target:t}=e,n={...f,theme_name:f?f.theme_name:"",json_data:f?f.json_data:""};n[t.name]=t.value,w(n)},value:null==f?void 0:f.theme_name,readOnly:E,placeholder:(0,o.t)("Enter theme name")})}),(0,a.FD)(D.l.Item,{label:(0,o.t)("JSON Configuration"),required:!E,children:[(0,a.Y)(m.F,{type:"info",showIcon:!0,closable:!1,className:"alert-info",message:(0,a.FD)("span",{children:[(0,o.t)("Design with")," ",(0,a.Y)("a",{href:"https://ant.design/theme-editor",target:"_blank",rel:"noopener noreferrer",children:(0,o.t)("Ant Design Theme Editor")}),(0,o.t)(", then paste the JSON below. See our")," ",(0,a.Y)("a",{href:"https://superset.apache.org/docs/configuration/theming/",target:"_blank",rel:"noopener noreferrer",children:(0,o.t)("documentation")}),(0,o.t)(" for details.")]})}),(0,a.Y)(N,{children:(0,a.Y)(F.iN,{showLoadingForImport:!0,name:"json_data",value:(null==f?void 0:f.json_data)||"",onChange:e=>{const t={...f,theme_name:f?f.theme_name:"",json_data:e};w(t)},tabSize:2,width:"100%",height:"300px",wrapEnabled:!0,readOnly:E,showGutter:!0,showPrintMargin:!1,annotations:J})}),I&&(0,a.Y)("div",{className:"apply-button-container",children:(0,a.Y)(r.m,{title:(0,o.t)("Set local theme for testing (preview only)"),placement:"top",children:(0,a.Y)(C.$,{icon:(0,a.Y)(A.F.ThunderboltOutlined,{}),onClick:()=>{if(null!=f&&f.json_data&&K(f.json_data))try{const e=JSON.parse(f.json_data);y(e),s&&s(),t&&t((0,o.t)("Local theme set for preview"))}catch(t){e((0,o.t)("Failed to apply theme: Invalid JSON"))}},disabled:!(null!=f&&f.json_data&&K(f.json_data)),buttonStyle:"secondary",children:(0,o.t)("Apply")})})})]})]})})})}));var $=n(23193);const E=l.I4.div`
  align-items: center;
  display: flex;

  .ant-tag {
    margin-left: ${({theme:e})=>2*e.sizeUnit}px;
  }
`,I=(0,o.t)("You are importing one or more themes that already exist. Overwriting might cause you to lose some of your work. Are you sure you want to overwrite?"),J=(0,f.Ay)((function({addDangerToast:e,addSuccessToast:t,user:n}){const{state:{loading:l,resourceCount:y,resourceCollection:f,bulkSelectEnabled:T},hasPerm:k,fetchData:C,refreshData:D,toggleBulkSelect:O}=(0,b.RU)("theme",(0,o.t)("Themes"),e),{setTemporaryTheme:F,getCurrentCrudThemeId:z}=(0,S.w)(),[x,N]=(0,i.useState)(!1),[j,J]=(0,i.useState)(null),[U,B]=(0,i.useState)(!1),[M,P]=(0,i.useState)(!1),[R,L]=(0,i.useState)(null),q=k("can_write"),K=k("can_write"),V=k("can_write"),W=k("can_export"),G=k("can_write"),Q=k("can_write"),[X,Z]=(0,i.useState)(null),ee=e=>{const t=e.map((({id:e})=>e)).filter((e=>void 0!==e));(0,v.A)("theme",t,(()=>{B(!1)})),B(!0)},te=[{id:"theme_name",desc:!0}],ne=(0,i.useMemo)((()=>[{Cell:({row:{original:e}})=>{var t;const n=z(),i=n&&(null==(t=e.id)?void 0:t.toString())===n||R&&e.id===R;return(0,a.FD)(E,{children:[e.theme_name,i&&(0,a.Y)(r.m,{title:(0,o.t)("This theme is set locally for your session"),children:(0,a.Y)(d.A,{color:"green",children:(0,o.t)("Local")})}),e.is_system&&(0,a.Y)(r.m,{title:(0,o.t)("Defined through system configuration."),children:(0,a.Y)(d.A,{color:"blue",children:(0,o.t)("System")})})]})},Header:(0,o.t)("Name"),accessor:"theme_name",id:"theme_name"},{Cell:({row:{original:{changed_on_delta_humanized:e,changed_by:t}}})=>(0,a.Y)(Y.UW,{date:e,user:t}),Header:(0,o.t)("Last modified"),accessor:"changed_on_delta_humanized",size:"xl",disableSortBy:!0,id:"changed_on_delta_humanized"},{Cell:({row:{original:n}})=>{const i=[Q?{label:"apply-action",tooltip:(0,o.t)("Set local theme. Will be applied to your session until unset."),placement:"bottom",icon:"ThunderboltOutlined",onClick:()=>function(n){if(n.json_data)try{const e=JSON.parse(n.json_data);F(e),L(n.id||null),t((0,o.t)('Local theme set to "%s"',n.theme_name))}catch(t){e((0,o.t)("Failed to set local theme: Invalid JSON configuration"))}}(n)}:null,K?{label:"edit-action",tooltip:n.is_system?(0,o.t)("View theme"):(0,o.t)("Edit theme"),placement:"bottom",icon:n.is_system?"EyeOutlined":"EditOutlined",onClick:()=>(J(n),void N(!0))}:null,W?{label:"export-action",tooltip:(0,o.t)("Export theme"),placement:"bottom",icon:"UploadOutlined",onClick:()=>ee([n])}:null,V&&!n.is_system?{label:"delete-action",tooltip:(0,o.t)("Delete theme"),placement:"bottom",icon:"DeleteOutlined",onClick:()=>Z(n)}:null].filter((e=>!!e));return(0,a.Y)(Y.kv,{actions:i})},Header:(0,o.t)("Actions"),id:"actions",disableSortBy:!0,hidden:!(K||V||Q||W),size:"xl"},{accessor:$.H.ChangedBy,hidden:!0,id:$.H.ChangedBy}]),[V,q,Q,W,R]),ae={name:(0,o.t)("Themes")},ie=[];G&&ie.push({name:(0,a.Y)(r.m,{id:"import-tooltip",title:(0,o.t)("Import themes"),placement:"bottomRight",children:(0,a.Y)(A.F.DownloadOutlined,{iconSize:"l","data-test":"import-button"})}),buttonStyle:"link",onClick:()=>{P(!0)}}),(V||W)&&ie.push({name:(0,o.t)("Bulk select"),onClick:O,buttonStyle:"secondary"}),q&&ie.push({name:(0,a.Y)(a.FK,{children:(0,o.t)("Theme")}),buttonStyle:"primary",icon:(0,a.Y)(A.F.PlusOutlined,{iconSize:"m"}),onClick:()=>{J(null),N(!0)}}),ae.buttons=ie;const le=(0,i.useMemo)((()=>[{Header:(0,o.t)("Name"),key:"search",id:"theme_name",input:"search",operator:Y.c0.Contains},{Header:(0,o.t)("Modified by"),key:"changed_by",id:"changed_by",input:"select",operator:Y.c0.RelationOneMany,unfilteredLabel:(0,o.t)("All"),fetchSelects:(0,_.u1)("theme","changed_by",(0,_.JF)((e=>(0,o.t)("An error occurred while fetching theme datasource values: %s",e))),n),paginate:!0}]),[]);return(0,a.FD)(a.FK,{children:[(0,a.Y)(w.A,{...ae}),(0,a.Y)(H,{addDangerToast:e,theme:j,onThemeAdd:()=>D(),onThemeApply:function(){L(null)},onHide:()=>N(!1),show:x,canDevelop:K}),(0,a.Y)(Y.zb,{resourceName:"theme",resourceLabel:(0,o.t)("theme"),passwordsNeededMessage:"",confirmOverwriteMessage:I,addDangerToast:e,addSuccessToast:t,onModelImport:()=>{P(!1),D(),t((0,o.t)("Theme imported"))},show:M,onHide:()=>{P(!1)}}),X&&(0,a.Y)(c.T,{description:(0,a.FD)(h.A,{direction:"vertical",size:"middle",style:{width:"100%"},children:[(0,a.Y)("div",{children:(0,o.t)("This action will permanently delete the theme.")}),(0,a.Y)(m.F,{type:"warning",showIcon:!0,closable:!1,message:(0,o.t)("Any dashboards using this theme will be automatically dissociated from it.")})]}),onConfirm:()=>{X&&(({id:n,theme_name:a})=>{s.A.delete({endpoint:`/api/v1/theme/${n}`}).then((()=>{D(),Z(null),t((0,o.t)("Deleted: %s",a))}),(0,_.JF)((t=>e((0,o.t)("There was an issue deleting %s: %s",a,t)))))})(X)},onHide:()=>Z(null),open:!0,title:(0,o.t)("Delete Theme?")}),(0,a.Y)(u.h,{title:(0,o.t)("Please confirm"),description:(0,a.FD)(h.A,{direction:"vertical",size:"middle",style:{width:"100%"},children:[(0,a.Y)("div",{children:(0,o.t)("Are you sure you want to delete the selected themes?")}),(0,a.Y)(m.F,{type:"warning",showIcon:!0,closable:!1,message:(0,o.t)("Any dashboards using these themes will be automatically dissociated from them.")})]}),onConfirm:n=>{const a=n.filter((e=>!e.is_system));0!==a.length?(a.length!==n.length&&e((0,o.t)("Skipped %d system themes that cannot be deleted",n.length-a.length)),s.A.delete({endpoint:`/api/v1/theme/?q=${g().encode(a.map((({id:e})=>e)))}`}).then((({json:e={}})=>{D(),t(e.message)}),(0,_.JF)((t=>e((0,o.t)("There was an issue deleting the selected themes: %s",t)))))):e((0,o.t)("Cannot delete system themes"))},children:n=>{const i=[];return V&&i.push({key:"delete",name:(0,o.t)("Delete"),onSelect:n,type:"danger"}),W&&i.push({key:"export",name:(0,o.t)("Export"),type:"primary",onSelect:ee}),(0,a.Y)(Y.uO,{className:"themes-list-view",columns:ne,count:y,data:f,fetchData:C,filters:le,initialSort:te,loading:l,pageSize:25,bulkActions:i,bulkSelectEnabled:T,disableBulkSelect:O,addDangerToast:e,addSuccessToast:t,refreshData:D})}}),U&&(0,a.Y)(p.R,{})]})}))}}]);