import{d as ae,c as T,e as P,f as d,J as xe,V as ie,v as re,a as ce,r,aH as ee,h as a,F as ue,j as e,H as w,w as l,n as pe,t as S,i as ye,k as de,B as me,m as N,a1 as be,a2 as Me,x as te,Q as Se,Z as Ie,p as ze,aJ as Ve,aW as Ce,aX as ne,$ as oe,aY as $e,aZ as ke,a_ as Ue,y as Le,a$ as Re,N as De,I as Y,b0 as se,b1 as Ae,E as Fe}from"./index-Bnsm-rWC.js";import{d as Pe}from"./exp-hdW52zLX.js";import{u as Ne}from"./groupDetail-DiXNuEVu.js";import{g as qe,a as He,s as je,b as Be,i as Ke,_ as Oe,c as Te,A as Ee,d as Je,F as Ze}from"./FileSaver.min-AEz3KKVC.js";import{_ as Ge}from"./DynamicForm.vue_vue_type_script_setup_true_lang-Dej44bLa.js";import{i as Qe}from"./json-editor-vue-C7edOXuD.js";import{_ as We,a as Xe}from"./FormItem-JLV7B7gs.js";import{a as _e,b as fe}from"./Tabs-DAAm3evk.js";import{A as Ye}from"./Add-BJ1rSi5D.js";import"./index-Oz2MLndu.js";import"./Copy16Filled-DpDEOBHE.js";import"./HandRight24Filled-BkQ8wwDq.js";import"./Popconfirm-D-QRqgOd.js";import"./InputNumber-DPR1aqh6.js";import"./Add-BG6oZ-p5.js";import"./Alert-DwH_q8gg.js";import"./debounce-DmmIAGQl.js";const ea={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},aa=ae({name:"FormNew24Regular",render:function(q,u){return P(),T("svg",ea,u[0]||(u[0]=[d("g",{fill:"none"},[d("path",{d:"M5.75 3A2.75 2.75 0 0 0 3 5.75v12.5A2.75 2.75 0 0 0 5.75 21h6.272a6.471 6.471 0 0 1-.709-1.5H5.75c-.69 0-1.25-.56-1.25-1.25V5.75c0-.69.56-1.25 1.25-1.25h12.5c.69 0 1.25.56 1.25 1.25v5.563a6.471 6.471 0 0 1 1.5.709V5.75A2.75 2.75 0 0 0 18.25 3H5.75zm12.207 8.016a.749.749 0 0 0-.703-1.014H12.25a.75.75 0 0 0 0 1.5h2.742a6.48 6.48 0 0 1 2.965-.486zM8.25 8.502a2.25 2.25 0 1 0 0 4.5a2.25 2.25 0 0 0 0-4.5zm-.75 2.25a.75.75 0 1 1 1.5 0a.75.75 0 0 1-1.5 0zM6 16.25a2.25 2.25 0 1 1 4.5 0a2.25 2.25 0 0 1-4.5 0zm2.25-.75a.75.75 0 1 0 0 1.5a.75.75 0 0 0 0-1.5zm9.004-8h-10.5a.75.75 0 1 1 0-1.5h10.5a.75.75 0 0 1 0 1.5zM23 17.5a5.5 5.5 0 1 0-11 0a5.5 5.5 0 0 0 11 0zm-4.999 3.003a.5.5 0 1 1-1 0V18h-2.505a.5.5 0 1 1 0-1H17v-2.5a.5.5 0 1 1 1 0V17h2.503a.5.5 0 1 1 0 1h-2.502v2.503z",fill:"currentColor"})],-1)]))}}),ta={class:"text-xl text-center"},na={class:"flex justify-end mt-5"},oa={class:"text-xl text-center pb-2"},sa={class:"flex justify-end pt-3 pr-5"},la={class:"flex justify-end mt-5"},ia=ae({__name:"SpaceModal",props:{spaceId:{}},setup(E,{expose:q}){const u=xe({}),B=E,K=ie(),I=re(),{t:i}=ce(),z=r(),p=r({space_name:void 0,description:void 0}),H=r({space_name:{required:!0,message:i("common.required")},description:{required:!0,message:i("common.required")}}),V=r(!1),C=r(!1),$=r(!1);r();const O=r(),m=r(),x=r(),g=r(),y=r(!1),b=r(!1),k=r(!1),t=()=>{k.value=!1,p.value={space_name:void 0,description:void 0}},s=()=>{b.value=!1,y.value=!1,x.value=void 0,m.value=void 0},_=n=>{n||t()},U=n=>{n||s()},L=n=>{n||(y.value=!1,x.value=void 0)},M=async()=>{const[n,o]=await qe();!n&&(o==null?void 0:o.status)===0&&(O.value=o.data,g.value=Object.keys(o.data||{})[0],Ce(()=>{D(g.value)}))},D=async n=>{const[o,c]=await He({initializer_name:n});!o&&(c==null?void 0:c.status)===0&&(m.value=c.data)},A=n=>{D(n)},J=async n=>{var R;if(V.value)return;V.value=!0;const o=await((R=u[n])==null?void 0:R.submit()),c=ne(o);if(oe(c)){V.value=!1;return}y.value=!0;const[h,f]=await je({device_group_name:I.query.device_group_name,space_id:B.spaceId,initializer_name:g.value,setting:c});V.value=!1,!h&&(f==null?void 0:f.status)===0&&(x.value=f.data)},Z=async n=>{var R;if(C.value)return;C.value=!0;const o=await((R=u[n])==null?void 0:R.submit()),c=ne(o);if(oe(c)){C.value=!1;return}const[h,f]=await Be({device_group_name:I.query.device_group_name,space_id:B.spaceId,initializer_name:g.value,setting:c});C.value=!1,!h&&(f==null?void 0:f.status)===0&&s()},G=async()=>{var n;$.value||($.value=!0,(n=z.value)==null||n.validate(async o=>{if(o){$.value=!1;return}const[c,h]=await Ke({device_group_name:I.query.device_group_name,...p.value});$.value=!1,!c&&(h==null?void 0:h.status)===0&&t()}))};return ee(b,n=>{n&&M()},{immediate:!0}),q({openInitialLizerModal:()=>b.value=!0,openAddModal:()=>k.value=!0}),(n,o)=>{const c=ye,h=de,f=Xe,R=We,Q=me,W=pe,X=ue,ve=Ie,ge=Se,he=fe,we=_e;return P(),T("div",null,[a(X,{show:e(k),"onUpdate:show":o[2]||(o[2]=v=>w(k)?k.value=v:null),onUpdateShow:_},{default:l(()=>[a(W,{style:{width:"700px",height:"320px","padding-top":"0"}},{default:l(()=>[d("div",ta,S(e(i)("groupDetail.parameterManager.createSpace")),1),a(c,{class:"!my-3"}),a(R,{ref_key:"addFormRef",ref:z,model:e(p),rules:e(H)},{default:l(()=>[a(f,{label:e(i)("groupDetail.parameterManager.spaceName"),path:"space_name"},{default:l(()=>[a(h,{value:e(p).space_name,"onUpdate:value":o[0]||(o[0]=v=>e(p).space_name=v)},null,8,["value"])]),_:1},8,["label"]),a(f,{label:e(i)("groupDetail.parameterManager.description"),path:"description"},{default:l(()=>[a(h,{value:e(p).description,"onUpdate:value":o[1]||(o[1]=v=>e(p).description=v)},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model","rules"]),d("div",na,[a(Q,{type:"primary",loading:e($),onClick:G},{default:l(()=>[N(S(e(i)("common.OK")),1)]),_:1},8,["loading"])])]),_:1})]),_:1},8,["show"]),a(X,{show:e(b),"onUpdate:show":o[6]||(o[6]=v=>w(b)?b.value=v:null),"onOnUpdate:show":U},{default:l(()=>[a(W,{style:{width:"800px","min-height":"600px",height:"80vh","padding-top":"0"}},{default:l(()=>[d("div",oa,S(e(i)("groupDetail.parameterManager.paramsTpl")),1),a(we,{type:"card",placement:"left",value:e(g),"onUpdate:value":o[5]||(o[5]=v=>w(g)?g.value=v:null),onUpdateValue:A},{default:l(()=>[(P(!0),T(be,null,Me(e(O),(v,F)=>(P(),te(he,{key:F,tab:v.title,name:F},{default:l(()=>[a(ge,{class:"pt-3 pl-4 pb-4"},{default:l(()=>[a(ve,{style:{"max-height":"calc(80vh - 140px)","padding-right":"20px"}},{default:l(()=>[e(m)?(P(),te(Ge,{ref_for:!0,ref:j=>e(u)[F]=j,cfgs:e(m),key:F},null,8,["cfgs"])):ze("",!0)]),_:2},1024),d("div",sa,[a(Q,{type:"primary",loading:e(V),onClick:()=>J(F)},{default:l(()=>[N(S(e(i)("common.OK")),1)]),_:2},1032,["loading","onClick"])]),a(X,{show:e(y),"onUpdate:show":o[4]||(o[4]=j=>w(y)?y.value=j:null),"onOnUpdate:show":L},{default:l(()=>[a(W,{style:{width:"700px"}},{default:l(()=>[o[7]||(o[7]=d("div",{class:"mb-5 text-xl text-center"},"Preview",-1)),a(e(Qe),{class:Ve(["w-full overflow-auto",[e(K).baseColor==="#000"?"jse-theme-dark":""]]),style:{height:"calc(80vh - 100px)"},disabled:"",modelValue:e(x),"onUpdate:modelValue":o[3]||(o[3]=j=>w(x)?x.value=j:null),mode:"text"},null,8,["class","modelValue"]),d("div",la,[a(Q,{type:"primary",loading:e(C),onClick:()=>Z(F)},{default:l(()=>[N(S(e(i)("common.submit")),1)]),_:2},1032,["loading","onClick"])])]),_:2},1024)]),_:2},1032,["show"])]),_:2},1024)]),_:2},1032,["tab","name"]))),128))]),_:1},8,["value"])]),_:1})]),_:1},8,["show"])])}}}),ra={class:"flex flex-1 items-center justify-between gap-2"},ca={class:"flex gap-2 items-center"},ua={class:"relative"},pa={class:"flex items-center gap-2"},le="spid",da=ae({__name:"ParamManager",setup(E){const q=re(),{t:u}=ce(),B=ie(),K=Ne(),I=r(),i=r(),z=r(!1),p=r(!1);ee(()=>K.spaceList,t=>{if(!t||p.value)return;const s=(M,D)=>t==null?void 0:t.find(A=>A[D]==M),_=$e(le),{space_name:U,space_id:L}=q.query;if(L&&s(L,"space_id"))i.value=+L,p.value=!0;else if(U&&s(U,"space_name")){const M=s(U,"space_name");i.value=M?+M.space_id:void 0,p.value=!0}else _&&s(_,"space_id")?(i.value=+_,p.value=!0):t[0]&&(i.value=+t[0].space_id,p.value=!0)},{immediate:!0});const H=r(),V=()=>{},C=t=>Y("div",{class:"flex gap-3 items-baseline"},[Y("div",{class:"text-base"},`${t.space_name}`),Y("div",{class:"text-xs opacity-50"},`[${new Date(t.create_time).toLocaleString()}] ${t.description}`)]),$=()=>{var t;(t=I.value)==null||t.openAddModal()},O=()=>{var t;(t=I.value)==null||t.openInitialLizerModal()},m=r(),x=()=>{var t;(t=m.value)!=null&&t.trim()&&(z.value=!0)},g=r(),y=r(),b=()=>{var t,s;(t=g.value)==null||t.refresh(),(s=y.value)==null||s.refresh()},k=async()=>{var _;const[t,s]=await Pe({group_name:q.query.device_group_name,space_id:i.value});!t&&(s==null?void 0:s.status)===0&&Ze.saveAs(`${se(location.origin)}/${se((_=s==null?void 0:s.data)==null?void 0:_.filename)}`,Ae(s.data.filename))};return ee(i,t=>{t&&localStorage.setItem(le,t)}),(t,s)=>{const _=me,U=ke,L=de,M=Le,D=De,A=fe,J=_e,Z=pe,G=ue;return P(),T("div",null,[a(J,{type:"card",animated:"",onUpdateValue:V,value:e(H),"onUpdate:value":s[2]||(s[2]=n=>w(H)?H.value=n:null),class:"!h-full"},{suffix:l(()=>[d("div",ra,[d("div",ca,[a(U,{trigger:"hover"},{trigger:l(()=>[a(_,{type:"primary",class:"!ml-1",onClick:k},{icon:l(()=>[a(e(Ee))]),_:1})]),default:l(()=>[N(" "+S(e(u)("expInfo.downloadSpaceParams")),1)]),_:1}),d("div",ua,[a(L,{style:{width:"310px","padding-right":"20px"},value:e(m),"onUpdate:value":s[0]||(s[0]=n=>w(m)?m.value=n:null),valueModifiers:{trim:!0},onKeyup:Ue(x,["enter"]),placeholder:e(u)("groupDetail.parameterManager.searchPlaceholder")},null,8,["value","placeholder"]),d("div",{class:"absolute -right-4 top-1/2 -translate-1/2 h-full w-8 flex items-center justify-center cursor-pointer",onClick:x},[a(M,{color:e(B).primaryColor,component:e(Re)},null,8,["color","component"])])])]),d("div",pa,[a(D,{options:e(K).spaceList,"render-label":C,value:e(i),"onUpdate:value":s[1]||(s[1]=n=>w(i)?i.value=n:null)},null,8,["options","value"]),a(_,{size:"small",type:"primary",class:"!h-[34px]",onClick:O},{icon:l(()=>[a(e(aa))]),default:l(()=>[N(" "+S(e(u)("groupDetail.parameterManager.initSpaceParams")),1)]),_:1}),a(_,{size:"small",type:"primary",class:"!h-[34px]",onClick:$},{icon:l(()=>[a(e(Ye))]),default:l(()=>[N(" "+S(e(u)("groupDetail.parameterManager.createSpace")),1)]),_:1})])])]),default:l(()=>[a(A,{name:"globalLatest","tab-type":"latest",tab:e(u)("groupDetail.parameterManager.globalLatest")},{default:l(()=>[a(Oe,{"space-id":e(i),ref_key:"paramsLatestRef",ref:g},null,8,["space-id"])]),_:1},8,["tab"]),a(A,{name:"globalHistory",tab:e(u)("groupDetail.parameterManager.globalHistory")},{default:l(()=>[a(Te,{"space-id":e(i),ref_key:"paramsHistoryRef",ref:y},null,8,["space-id"])]),_:1},8,["tab"])]),_:1},8,["value"]),a(ia,{ref_key:"spaceModalRef",ref:I,"space-id":e(i)},null,8,["space-id"]),a(G,{show:e(z),"onUpdate:show":s[4]||(s[4]=n=>w(z)?z.value=n:null),size:"huge"},{default:l(()=>[a(Z,{style:{"min-height":"400px",overflow:"auto",width:"1300px","max-width":"95vw","min-width":"500px"}},{default:l(()=>[a(Je,{search:"","space-id":e(i),"hide-history-option":"",modelValue:e(m),"onUpdate:modelValue":s[3]||(s[3]=n=>w(m)?m.value=n:null),onRefresh:b},null,8,["space-id","modelValue"])]),_:1})]),_:1},8,["show"])])}}}),ka=Fe(da,[["__scopeId","data-v-5dcb2f46"]]);export{ka as default};
