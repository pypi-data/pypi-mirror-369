import"../chunks/DsnmJJEf.js";import{o as rt,s as at}from"../chunks/BIHB8bOP.js";import{p as st,s as o,b as y,u as z,g as e,l as g,d as le,j as r,t as ot,e as L,h as f,f as F,a as h,i as lt,c as ve,n as nt,m as ne,r as ie,v as it}from"../chunks/C2qtcxMB.js";import{i as m}from"../chunks/CUUZcSt3.js";import{u as ut,g as U,e as ct,i as dt}from"../chunks/C1XT8suU.js";import{s as Be}from"../chunks/yfEWpjCL.js";import{F as _t,e as ge,b as he,S as ft,c as vt,t as gt,h as ht,f as Ie,r as mt}from"../chunks/B9Y7L0uS.js";import{A as W,T as Re}from"../chunks/BAPfGkfQ.js";import{R as pt}from"../chunks/CpyVfaW9.js";import{B as bt}from"../chunks/ChhGfueq.js";import{g as xt}from"../chunks/CqS7hfz2.js";var yt=L('<label class="col-6 col-md-2">Subdivision</label> <div class="col-4 col-md-2"><!></div>',1),wt=L('<div class="row mb-2"><label class="col-6 col-md-3 fw-medium fs-4"> </label> <div class="col-4 col-md-2"><!></div> <!></div>'),Ct=L("<h3>Technologies (for Capex/Opex)</h3> <!> <!> <!> <!> <!>",1),St=L("<!> <!> <!>",1),jt=L("<!> <!> <!>",1),Ot=L("<!> <!>",1),Tt=L('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),$t=L('<div class="text-center">No data with this selection.</div>'),Pt=L('<div class="text-center">Please select at least one year.</div>'),kt=L('<h1 class="mt-2 mb-4">The Transition Pathway &ndash; Costs</h1> <!> <div class="mt-4"><!></div>',1);function Yt(Ne,Ve){st(Ve,!0);const u="Techology / Carrier",je=" (Capex)",Oe=" (Opex)",Ye="Capex",qe="Opex",ze="Carrier",Ge="Shed Demand";let Te=o(y([])),$e=o(y([])),X=o(y([]));const Pe=["Location",u];let ue=o(null),Z=o(null),w=o(null),j=o(null),ee=o(null),ce=o(y({})),te=o(y([])),n=o(null),G=o(y([])),O=o(y([])),T=o(y([])),M=o(y([])),A=o(y([])),B=o(y([])),de=o("Location"),me=o(!0),pe=o(!0),be=o(!0),xe=o(!0),ye=o(!0),re=o(!1),ae=o(!1),$=y({capex:{title:"Capex",show:!0,subdivision:!1,show_subdivision:!0,label:Ye},opex:{title:"Opex",show:!0,subdivision:!1,show_subdivision:!0,label:qe},carrier:{title:"Carrier",show:!0,subdivision:!1,show_subdivision:!0,label:ze},shed_demand:{title:"Shed Demand",show:!0,subdivision:!1,show_subdivision:!0,label:Ge},carbon_emission:{title:"Carbon Emissions",show:!0,subdivision:!1,show_subdivision:!1}}),He=g(()=>{if(!e(n))return"";let t=e(n).solution_name.split(".");return[t[t.length-1],e(n).scenario_name,"costs"].join("_")}),ke=g(()=>e(R).length>0?e(ce)[e(R)[0]]||"":e(I).length>0?e(ce)[e(I)[0]]||"":e(N).length>0&&e(ce)[e(N)[0]]||""),Je=g(()=>({responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:`Costs [${e(ke)}]`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"},plugins:{tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue} ${e(ke)}`}}}})),Ke=g(()=>e(G).map(t=>t.toString())),we=g(()=>!e(w)||!e(j)?new Set:new Set([...e(w).data.map(t=>t[u])||[],...e(j).data.map(t=>t[u])||[]])),I=g(()=>!e(n)||!e(w)||!e(j)?[]:e(n).detail.system.set_transport_technologies.filter(t=>e(we).has(t))),R=g(()=>!e(n)||!e(w)||!e(j)?[]:ge(e(n).detail.system.set_conversion_technologies.filter(t=>e(we).has(t)))),N=g(()=>!e(n)||!e(w)||!e(j)?[]:ge(e(n).detail.system.set_storage_technologies.filter(t=>e(we).has(t)))),H=g(()=>!e(n)||!e(Z)?.data?[]:ge(e(Z).data.map(t=>t[u]))),J=g(()=>!e(n)||!e(ee)?.data?[]:ge(e(ee).data.map(t=>t[u]))),Ce=g(()=>e(n)?Object.keys(e(n).detail.edges).concat(e(n).detail.system.set_nodes):[]);z(()=>{e(I),le(()=>{e(me)&&e(w)&&e(j)?(r(me,!1),e(I).length>0&&e(M).length===0&&r(M,e(I),!0)):e(I).length>0&&r(M,e(I),!0)})}),z(()=>{e(R),le(()=>{e(pe)&&e(w)&&e(j)?(r(pe,!1),e(R).length>0&&e(B).length===0&&r(B,e(R),!0)):e(R).length>0&&r(B,e(R),!0)})}),z(()=>{e(N),le(()=>{e(be)&&e(w)&&e(j)?(r(be,!1),e(N).length>0&&e(A).length===0&&r(A,e(N),!0)):e(N).length>0&&r(A,e(N),!0)})}),z(()=>{e(H),le(()=>{e(xe)&&e(Z)?(r(xe,!1),e(H).length>0&&e(O).length===0&&r(O,e(H),!0)):e(H).length>0&&r(O,e(H),!0)})}),z(()=>{e(J),le(()=>{e(ye)&&e(ee)?(r(ye,!1),e(J).length>0&&e(T).length===0&&r(T,e(J),!0)):e(J).length>0&&r(T,e(J),!0)})}),z(()=>{r(te,e(Ce),!0)}),z(()=>{r(G,e(X),!0)}),rt(()=>{Object.entries($).forEach(([t,l])=>{let c=U(t+"_show"),p=U(t+"_subdivision");l.show=c!==null?c==="true":l.show,l.subdivision=p!==null?p==="true":l.subdivision}),r(M,U("transport_technologies")?.split(",")||[],!0),r(me,!0),r(B,U("conversion_technologies")?.split(",")||[],!0),r(pe,!0),r(A,U("storage_technologies")?.split(",")||[],!0),r(be,!0),r(O,U("cost_carriers")?.split(",")||[],!0),r(xe,!0),r(T,U("demand_carriers")?.split(",")||[],!0),r(ye,!0)}),z(()=>{e(M),e(B),e(A),e(O),e(T),Object.values($).forEach(t=>{t.show,t.subdivision}),ot().then(()=>{let t={transport_technologies:e(M).join(","),conversion_technologies:e(B).join(","),storage_technologies:e(A).join(","),cost_carriers:e(O).join(","),demand_carriers:e(T).join(",")};Object.entries($).forEach(([l,c])=>{t[l+"_show"]=c.show?"true":"false",t[l+"_subdivision"]=c.subdivision?"true":"false"}),ut(t)})});function Qe(){e(n)&&Ue()}function _e(t,l){return!t||!t.data||(t.data=t.data.map(c=>l.reduce((p,[b,P])=>{if(!(b in c))return p;const{[b]:C,...k}=p;return{...k,[P]:C}},c))),t}async function Ue(){if(!e(n))return;r(ae,!0);let t=await ht(e(n).solution_name,["cost_capex_yearly","cost_opex_yearly","cost_carbon_emissions_total","cost_carrier","cost_shed_demand"].map(l=>xt(l,e(n)?.version)),e(n).scenario_name);r(w,_e(t.cost_capex_yearly||null,[["technology",u]]),!0),r(j,_e(t.cost_opex_yearly||null,[["technology",u]]),!0),r(ue,t.cost_carbon_emissions_total||null,!0),r(Z,_e(t.cost_carrier||null,[["node","location"],["carrier",u]]),!0),r(ee,_e(t.cost_shed_demand||null,[["node","location"],["carrier",u]]),!0),t.unit?.data&&r(ce,Object.fromEntries(t.unit.data.map(l=>[l.technology,l[0]||l.units])),!0),r(ae,!1)}let Se=g(()=>{let t=[...e(B).concat(e(A)).concat(e(M)).flatMap(a=>[a+je,a+Oe]),...e(O),...e(T)],l=e(X).filter(a=>!e(G).includes(a));const c=[{key:"capex",data:(e(w)?.data||[]).map(a=>({...a,[u]:a[u]+je}))},{key:"opex",data:(e(j)?.data||[]).map(a=>({...a,[u]:a[u]+Oe}))},{key:"carrier",data:(e(Z)?.data||[]).filter(a=>e(O).includes(a[u]))},{key:"shed_demand",data:(e(ee)?.data||[]).filter(a=>e(T).includes(a[u]))||null}];let p=c.flatMap(({key:a,data:s})=>!$[a].show||!s?[]:$[a].subdivision?s:Ie(s,{location:e(te)},{[u]:t},l,!1).map(S=>({...S.data,location:S.label,[u]:$[a].label})));c.forEach(({key:a})=>{$[a].label&&t.push($[a].label)});let b,P;e(de)==u?(b={location:e(Ce)},P={[u]:t}):(b={[u]:t},P={location:e(te)}),mt();let C=Ie(p,b,P,[],!1),k=[];return e(ue)?.data&&e(ue).data.length>0&&$.carbon_emission.show&&(k=[{data:Object.entries(e(ue).data[0]).filter(([s])=>!l.includes(Number(s))).map(([s,S])=>S),label:"Total Carbon Costs",type:"bar"}]),[...C,...k]});var Ee=kt(),De=f(F(Ee),2);_t(De,{children:(t,l)=>{var c=Ot(),p=F(c);he(p,{title:"Solution Selection",children:(C,k)=>{{let a=g(()=>e(ae)||e(re));ft(C,{solution_selected:Qe,get disabled(){return e(a)},get carriers(){return e(Te)},set carriers(s){r(Te,s,!0)},get nodes(){return e($e)},set nodes(s){r($e,s,!0)},get years(){return e(X)},set years(s){r(X,s,!0)},get selected_solution(){return e(n)},set selected_solution(s){r(n,s,!0)},get loading(){return e(re)},set loading(s){r(re,s,!0)}})}}});var b=f(p,2);{var P=C=>{var k=jt(),a=F(k);he(a,{title:"Cost Selection",children:(K,fe)=>{var E=ve(),v=F(E);ct(v,17,()=>Object.values($),dt,(V,x,Y)=>{var q=wt(),d=ne(q);Be(d,"for","variables"+Y);var D=ne(d,!0);ie(d);var Q=f(d,2),se=ne(Q);Re(se,{formId:"variables"+Y,get value(){return e(x).show},set value(_){e(x).show=_}}),ie(Q);var oe=f(Q,2);{var i=_=>{var Le=yt(),Me=F(Le);Be(Me,"for","subdivision"+Y);var Ae=f(Me,2),et=ne(Ae);Re(et,{formId:"subdivision"+Y,get value(){return e(x).subdivision},set value(tt){e(x).subdivision=tt}}),ie(Ae),h(_,Le)};m(oe,_=>{e(x).show&&e(x).show_subdivision&&_(i)})}ie(q),it(()=>at(D,e(x).title)),h(V,q)}),h(K,E)}});var s=f(a,2);he(s,{title:"Technology Selection",children:(K,fe)=>{var E=Ct(),v=f(F(E),2);{var V=i=>{W(i,{label:"Transport",get elements(){return e(I)},get value(){return e(M)},set value(_){r(M,_,!0)}})};m(v,i=>{e(I).length>0&&i(V)})}var x=f(v,2);{var Y=i=>{W(i,{label:"Storage",get elements(){return e(N)},get value(){return e(A)},set value(_){r(A,_,!0)}})};m(x,i=>{e(N).length>0&&i(Y)})}var q=f(x,2);{var d=i=>{W(i,{label:"Conversion",get elements(){return e(R)},get value(){return e(B)},set value(_){r(B,_,!0)}})};m(q,i=>{e(R).length>0&&i(d)})}var D=f(q,2);{var Q=i=>{W(i,{label:"Cost of Carrier",get elements(){return e(H)},get value(){return e(O)},set value(_){r(O,_,!0)}})};m(D,i=>{e(H).length>0&&i(Q)})}var se=f(D,2);{var oe=i=>{W(i,{label:"Shed Demand",get elements(){return e(J)},get value(){return e(T)},set value(_){r(T,_,!0)}})};m(se,i=>{e(J).length>0&&i(oe)})}h(K,E)}});var S=f(s,2);he(S,{title:"Data Selection",children:(K,fe)=>{var E=St(),v=F(E);vt(v,{label:"Aggregation",content:(D,Q=nt)=>{{let se=g(()=>gt(Pe));pt(D,{get formId(){return Q()},get options(){return e(se)},get value(){return e(de)},set value(oe){r(de,oe,!0)}})}}});var V=f(v,2);{var x=d=>{W(d,{label:"Locations",get elements(){return e(Ce)},get value(){return e(te)},set value(D){r(te,D,!0)}})};m(V,d=>{e(de)==Pe[1]&&d(x)})}var Y=f(V,2);{var q=d=>{W(d,{label:"Years",get elements(){return e(X)},get value(){return e(G)},set value(D){r(G,D,!0)}})};m(Y,d=>{e(G)&&d(q)})}h(K,E)}}),h(C,k)};m(b,C=>{!e(ae)&&!e(re)&&e(w)&&e(n)!=null&&C(P)})}h(t,c)}});var Fe=f(De,2),We=ne(Fe);{var Xe=t=>{var l=Tt();h(t,l)},Ze=t=>{var l=ve(),c=F(l);{var p=b=>{var P=ve(),C=F(P);{var k=s=>{var S=$t();h(s,S)},a=s=>{var S=ve(),K=F(S);{var fe=v=>{var V=Pt();h(v,V)},E=v=>{bt(v,{type:"line",get options(){return e(Je)},get datasets(){return e(Se)},get labels(){return e(Ke)},get plot_name(){return e(He)}})};m(K,v=>{e(G).length==0?v(fe):v(E,!1)},!0)}h(s,S)};m(C,s=>{e(Se).length==0||e(Se)[0].data.length==0?s(k):s(a,!1)})}h(b,P)};m(c,b=>{e(n)!=null&&b(p)},!0)}h(t,l)};m(We,t=>{e(re)||e(ae)?t(Xe):t(Ze,!1)})}ie(Fe),h(Ne,Ee),lt()}export{Yt as component};
