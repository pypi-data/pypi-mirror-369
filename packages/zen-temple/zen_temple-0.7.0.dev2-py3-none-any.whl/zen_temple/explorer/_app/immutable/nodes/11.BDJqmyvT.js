import"../chunks/DsnmJJEf.js";import{o as Ye,s as Le}from"../chunks/BIHB8bOP.js";import{p as Re,s as f,b as k,u as U,g as e,l as v,d as ie,j as r,t as Ve,e as P,h as w,f as j,a as g,i as qe,c as W,n as ye,m as X,r as Z,v as Ge}from"../chunks/C2qtcxMB.js";import{i as F}from"../chunks/CUUZcSt3.js";import{u as He,g as ee,e as Je,i as Ke}from"../chunks/C5eeVdB9.js";import{s as xe}from"../chunks/yfEWpjCL.js";import{F as Qe,e as Ue,b as te,S as We,c as Se,h as Xe,t as Ze,r as et,i as tt,f as rt}from"../chunks/31Q1F_Lr.js";import{A as se,T as le}from"../chunks/D-PbE5bO.js";import{B as st}from"../chunks/DOamgyJD.js";import{D as ot}from"../chunks/BJPOgFfc.js";var nt=P('<label class="col-6 col-md-2 fw-medium fs-5">Subdivision</label> <div class="col-4 col-md-2"><!></div>',1),it=P('<div class="row align-items-baseline"><label class="col-6 col-md-3 fw-medium fs-4"> </label> <div class="col-4 col-md-3"><!></div> <!></div>'),lt=P("<!> <!>",1),at=P("<!> <!> <!>",1),ut=P("<!> <!> <!> <!>",1),dt=P("<!> <!>",1),_t=P('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),ct=P("<div></div>"),ft=P('<div class="text-center">No carriers with this selection.</div>'),vt=P('<div class="text-center">No data with this selection.</div>'),gt=P('<h1 class="mt-2 mb-4">The Transition Pathway &ndash; Production</h1> <!> <div class="plot mt-4"><!></div>',1);function Pt($e,je){Re(je,!0);let T=f(null),H=f(k([])),J=f(k([])),ae=f(k([])),L=k([{id:"conversion",title:"Conversion",show:!0,subdivision:!1,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_conversion_output",positive_label:"Conversion output",negative:"flow_conversion_input",negative_label:"Conversion input"},{id:"storage",title:"Storage",show:!0,subdivision:!1,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_storage_discharge",positive_label:"Storage discharge",positive_suffix:" (discharge)",negative:"flow_storage_charge",negative_label:"Storage charge",negative_suffix:" (charge)"},{id:"import_export",title:"Import/Export",show:!0,subdivision:!1,show_subdivision:!1,filter_by_technologies:!1,positive:"flow_import",positive_label:"Import",negative:"flow_export",negative_label:"Export"},{id:"demand_shed_demand",title:"Demand/Shed Demand",show:!0,subdivision:!1,show_subdivision:!1,filter_by_technologies:!1,positive:"shed_demand",positive_label:"Shed Demand",negative:"demand",negative_label:"Demand"}]),i=f(null),d=f(null),N=f(k([])),C=f(k([])),ue=v(()=>[...e(N),...e(C)]),M=f(!1),R=f(k([])),V=f(k([])),re=f(!0),de=f(!0),O=f(!1),D=f(!1),Pe=v(()=>{if(!e(i)?.solution_name||!e(d))return"";let t=e(i).solution_name.split(".");return[t[t?.length-1],e(i).scenario_name,e(d)].join("_")}),_e=f(k([])),ce=v(()=>{let t=null;return!t&&e(d)&&(t=e(_e).find(s=>s.carrier==e(d))),t&&(t[0]||t.units)||""}),Ne=v(()=>e(V).map(t=>t.toString())),Ce=v(()=>({responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:"Production"+(e(M)?"":` [${e(ce)}]`)},max:e(M)?1:void 0,suggestedMin:e(M)?-1:void 0}},plugins:{tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue}`+(e(M)?"":` ${e(ce)}`)}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}})),z=v(()=>e(i)?e(i).detail.system.set_carriers.slice().sort():[]),B=v(()=>e(i)?Ue(Object.entries(e(i).detail.carriers_input).concat(Object.entries(e(i).detail.carriers_output)).filter(t=>e(d)&&t[1].includes(e(d))).map(t=>t[0])):[]),A=v(()=>e(i)?e(i).detail.system.set_storage_technologies.filter(t=>e(i)?.detail.reference_carrier[t]==e(d)):[]);U(()=>{e(z),ie(()=>{(e(z).length>=1&&!e(d)||!e(z).includes(e(d)))&&r(d,e(z)[0],!0)})}),U(()=>{e(B),ie(()=>{e(re)?(r(re,!1),e(N).length==0&&e(B).length>0&&r(N,e(B),!0)):(e(B).length>0||e(N).some(t=>!e(B).includes(t)))&&r(N,e(B),!0)})}),U(()=>{e(A),ie(()=>{e(de)?(r(de,!1),e(C).length==0&&e(A).length>0&&r(C,e(A),!0)):(e(A).length>0||e(C).some(t=>!e(A).includes(t)))&&r(C,e(A),!0)})}),U(()=>{r(R,e(J),!0)}),Ye(()=>{r(d,ee("carrier")||null,!0),L.forEach(t=>{let s=ee(t.id+"_show"),n=ee(t.id+"_subdivision");t.show=s!==null?s==="true":t.show,t.subdivision=n!==null?n==="true":t.subdivision}),r(N,ee("conversion_technologies")?.split(",")||[],!0),r(re,!0),r(C,ee("storage_technologies")?.split(",")||[],!0),r(re,!0)}),U(()=>{e(d),L.forEach(t=>{t.show,t.subdivision}),e(N),e(C),Ve().then(()=>{let t={carrier:e(d),conversion_technologies:e(N).join(","),storage_technologies:e(C).join(",")};L.forEach(s=>{t[s.id+"_show"]=s.show?"true":"false",t[s.id+"_subdivision"]=s.subdivision?"true":"false"}),He(t)})});function Oe(){r(V,e(H),!0),r(R,e(J),!0)}async function De(){Oe(),await Ee()}async function Ee(){if(e(i)===null)return;r(D,!0),r(T,null);const t=await Xe(e(i).solution_name,["flow_conversion_output","flow_conversion_input","flow_storage_discharge","flow_storage_charge","flow_import","flow_export","shed_demand","demand"],e(i).scenario_name,"demand");r(T,L.flatMap(s=>[t[s.positive]||null,t[s.negative]||null]),!0),t.unit?.data&&r(_e,t.unit.data,!0),r(D,!1)}function ke(t,s,n){return s.subdivision?t:Object.entries(t.reduce((l,h)=>{const a=h.node,_=h.technology;if(n&&!n.includes(_))return l;let y=Object.fromEntries(Object.entries(h).filter(([m])=>!isNaN(Number(m))).map(([m,o])=>[m,Number(o)]));return l[a]=l[a]||{technology:s.title,data:{}},l[a].data=Object.fromEntries(Object.entries(y).map(([m,o])=>[m,(o||0)+(l[a].data[m]||0)])),l},{})).map(([l,h])=>({...h.data,technology:h.technology,node:l}))}function fe(t,s,n,l,h,a){if(t===null)return[];let _={technology:[...e(ue),s.title]},y={node:e(R)};const m=ke(t.data.filter(p=>p.carrier===void 0||p.carrier==e(d)),s,s.filter_by_technologies?e(ue):void 0);let o=rt(m,_,y,n,!1,void 0,h||"");return a!==void 0&&(o=o.map(a)),!s.subdivision&&o.length>0&&(o[0].label=l),o}let ve=v(()=>{if(e(R).length==0||e(V).length==0||!e(T)||e(T).length==0)return[];let t=e(H).filter(n=>!e(V).includes(n));et();let s=L.flatMap((n,l)=>{if(!n.show||!e(T))return[];let h=fe(e(T)[2*l],n,t,n.positive_label,n.positive_suffix,void 0),a=fe(e(T)[2*l+1],n,t,n.negative_label,n.negative_suffix,_=>({..._,data:Object.values(_.data).map(y=>-y)}));return[...h,...a]});return e(M)?tt(s):s});var ge=gt(),me=w(j(ge),2);Qe(me,{children:(t,s)=>{var n=dt(),l=j(n);te(l,{title:"Solution Selection",children:(_,y)=>{{let m=v(()=>e(D)||e(O));We(_,{solution_selected:De,get disabled(){return e(m)},get selected_solution(){return e(i)},set selected_solution(o){r(i,o,!0)},get years(){return e(H)},set years(o){r(H,o,!0)},get nodes(){return e(J)},set nodes(o){r(J,o,!0)},get edges(){return e(ae)},set edges(o){r(ae,o,!0)},get loading(){return e(O)},set loading(o){r(O,o,!0)}})}}});var h=w(l,2);{var a=_=>{var y=ut(),m=j(y);te(m,{title:"Carrier Selection",children:(x,G)=>{var c=W(),S=j(c);{var I=u=>{Se(u,{label:"Carrier",content:(E,b=ye)=>{{let K=v(()=>Ze(e(z))),Y=v(()=>e(O)||e(D));ot(E,{get formId(){return b()},get options(){return e(K)},get disabled(){return e(Y)},get value(){return e(d)},set value(ne){r(d,ne,!0)}})}}})};F(S,u=>{e(z).length>0&&u(I)})}g(x,c)}});var o=w(m,2);te(o,{title:"Production Component Selection",children:(x,G)=>{var c=W(),S=j(c);Je(S,17,()=>L,Ke,(I,u,$)=>{var E=it(),b=X(E);xe(b,"for","variables"+$);var K=X(b,!0);Z(b);var Y=w(b,2),ne=X(Y);le(ne,{formId:"variables"+$,get value(){return e(u).show},set value(Q){e(u).show=Q}}),Z(Y);var Me=w(Y,2);{var ze=Q=>{var pe=nt(),be=j(pe);xe(be,"for","subdivision"+$);var we=w(be,2),Be=X(we);le(Be,{formId:"subdivision"+$,get value(){return e(u).subdivision},set value(Ae){e(u).subdivision=Ae}}),Z(we),g(Q,pe)};F(Me,Q=>{e(u).show&&e(u).show_subdivision&&Q(ze)})}Z(E),Ge(()=>Le(K,e(u).title)),g(I,E)}),g(x,c)}});var p=w(o,2);te(p,{title:"Technology Selection",children:(x,G)=>{var c=lt(),S=j(c);{let u=v(()=>e(O)||e(D));se(S,{label:"Conversion",get elements(){return e(B)},get disabled(){return e(u)},get value(){return e(N)},set value($){r(N,$,!0)}})}var I=w(S,2);{let u=v(()=>e(O)||e(D));se(I,{label:"Storage",get elements(){return e(A)},get disabled(){return e(u)},get value(){return e(C)},set value($){r(C,$,!0)}})}g(x,c)}});var q=w(p,2);{var oe=x=>{te(x,{title:"Data Selection",children:(G,c)=>{var S=at(),I=j(S);Se(I,{label:"Normalization",content:(b,K=ye)=>{le(b,{get formId(){return K()},get value(){return e(M)},set value(Y){r(M,Y,!0)}})}});var u=w(I,2);{let E=v(()=>e(O)||e(D));se(u,{label:"Nodes",get elements(){return e(J)},get disabled(){return e(E)},get value(){return e(R)},set value(b){r(R,b,!0)}})}var $=w(u,2);{let E=v(()=>e(O)||e(D));se($,{label:"Years",get elements(){return e(H)},get disabled(){return e(E)},get value(){return e(V)},set value(b){r(V,b,!0)}})}g(G,S)}})};F(q,x=>{!e(D)&&e(d)!=null&&x(oe)})}g(_,y)};F(h,_=>{!e(O)&&e(i)&&_(a)})}g(t,n)}});var he=w(me,2),Ie=X(he);{var Fe=t=>{var s=_t();g(t,s)},Te=t=>{var s=W(),n=j(s);{var l=a=>{var _=ct();g(a,_)},h=a=>{var _=W(),y=j(_);{var m=p=>{var q=ft();g(p,q)},o=p=>{var q=W(),oe=j(q);{var x=c=>{var S=vt();g(c,S)},G=c=>{st(c,{type:"bar",get options(){return e(Ce)},get labels(){return e(Ne)},get datasets(){return e(ve)},get plot_name(){return e(Pe)}})};F(oe,c=>{e(ve).length==0?c(x):c(G,!1)},!0)}g(p,q)};F(y,p=>{e(z).length==0?p(m):p(o,!1)},!0)}g(a,_)};F(n,a=>{e(i)==null?a(l):a(h,!1)},!0)}g(t,s)};F(Ie,t=>{e(O)||e(D)?t(Fe):t(Te,!1)})}Z(he),g($e,ge),qe()}export{Pt as component};
