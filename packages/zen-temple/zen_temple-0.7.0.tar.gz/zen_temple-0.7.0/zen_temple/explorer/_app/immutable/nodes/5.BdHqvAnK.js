import"../chunks/DsnmJJEf.js";import{o as Xe}from"../chunks/BIHB8bOP.js";import{p as et,s as i,b as ie,u as L,g as e,l as _,d as U,t as Pe,j as r,o as tt,e as v,h as D,f as b,a as n,i as at,n as de,m as rt,r as lt,c as Y}from"../chunks/C2qtcxMB.js";import{i as P,b as Te}from"../chunks/CUUZcSt3.js";import{A as $e,T as ot}from"../chunks/CpAjmBpr.js";import{d as nt,F as st,f as Ae,e as fe,r as it,b as ve,S as dt,c as ue,t as me}from"../chunks/DZujSHY9.js";import{B as Ie}from"../chunks/l0zfogOA.js";import{D as pe}from"../chunks/B-RRlO2g.js";import{u as ut,g as he}from"../chunks/Bdn9nyjV.js";var _t=v("<!> <!> <!>",1),gt=v("<!> <!> <!>",1),ct=v("<!> <!>",1),ft=v("<!> <!>",1),vt=v('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),mt=v('<div class="text-center">No technologies with this selection.</div>'),pt=v('<div class="text-center">No carriers with this selection.</div>'),ht=v('<div class="text-center">No solution selected.</div>'),bt=v('<div class="text-center">No locations with this selection.</div>'),yt=v('<div class="text-center">No data available for this selection.</div>'),wt=v('<div class="text-center">No flow data available for this selection.</div>'),xt=v("<!> <!>",1),St=v('<h1 class="mt-2 mb-4">The Energy Balance &ndash; Storage</h1> <!> <div class="mt-4 plot"><!></div>',1);function At(Be,We){et(We,!0);let y=null,X=null,ee=null,te=null,ae=null,re=i(0),be=i(ie({})),W=i(ie([]));const je=["Hourly","Daily","Weekly","Monthly"];let s=i(null),f=i(null),w=i(""),j=i("Hourly"),q=i(!0),T=i(ie([])),$=i(ie([])),M=i(!1),A=i(!1),G=i(void 0),J=i(void 0),ye=_(()=>e(V).length>0?e(be)[e(V)[0]]:""),we=_(()=>{if(!e(s)||!e(s).solution_name)return"";let a=e(s).solution_name.split(".");return[a[a.length-1],e(s).scenario_name,"storage_level",e(f)].join("_")}),Me=_(()=>e(we)+"_flows"),Re=_(()=>xe("Storage Level",a=>e(J)?.zoom_rect(a.chart.scales.x.min,a.chart.scales.x.max))),Ee=_(()=>xe("Storage Flow",a=>e(G)?.zoom_rect(a.chart.scales.x.min,a.chart.scales.x.max)));function xe(a,t){return{animation:!1,normalized:!0,parsing:!1,elements:{point:{radius:0},line:{borderWidth:1}},responsive:!0,scales:{x:{type:"linear",stacked:!0,title:{display:!0,text:"Time"},ticks:{maxRotation:0,autoSkip:!0,callback:o=>Number(o).toFixed(0)},min:0,max:e(s)?.detail?.system.total_hours_per_year},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:`${a} [${e(ye)}]`}}},plugins:{zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x",onPanComplete:t},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x",onZoomComplete:t},limits:{x:{minRange:10,min:"original",max:"original"}}},decimation:{enabled:!0,algorithm:"min-max"},tooltip:{callbacks:{label:o=>`${o.dataset.label}: ${o.formattedValue} ${e(ye)}`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}}let Q=_(()=>(e(re),y?fe(y.data.map(a=>a.node)).sort():[])),R=_(()=>{if(e(re),!y||!e(s))return[];let a=Array.from(y.data.map(t=>t.technology));return fe(y.data.filter(t=>a.includes(t.technology)).map(t=>e(s).detail.reference_carrier[t.technology]))}),V=_(()=>(e(re),!y||!e(s)||e(R).length===0?[]:fe(y.data.map(t=>t.technology)).filter(t=>e(s).detail.reference_carrier[t]==e(f))));L(()=>{e(V),U(()=>{r(T,e(V),!0)})}),L(()=>{e(Q),U(()=>{r($,e(Q),!0)})}),L(()=>{e(R),U(()=>{e(R).length>0&&(!e(f)||!e(R).includes(e(f)))&&(r(f,e(R)[0],!0),oe())})}),L(()=>{e(W),U(()=>{e(W).length>0&&(!e(w)||!e(W).includes(Number(e(w))))&&(r(w,e(W)[0].toString(),!0),oe())})}),L(()=>{e(f),e(q),e(T),e($),U(oe)}),Xe(()=>{r(f,he("carrier")||e(f),!0),r(w,he("year")||e(w),!0),r(j,he("window_size")||e(j),!0)}),L(()=>{e(w),e(f),e(j),Pe().then(()=>{ut({year:e(w),carrier:e(f),window_size:e(j)})})}),L(()=>{He()});async function He(){if(e(s)===null||!e(w))return;r(A,!0);let a={Daily:24,Weekly:168,Monthly:720}[e(j)]||1;const t=await nt(e(s).solution_name,["storage_level","flow_storage_charge","flow_storage_discharge","flow_storage_spillage","flow_storage_inflow"],e(s).scenario_name,"storage_level",Number(e(w)),a);y=t.storage_level||null,X=t.flow_storage_charge||null,ee=t.flow_storage_discharge||null,te=t.flow_storage_spillage||null,ae=t.flow_storage_inflow||null,tt(re),t.unit?.data&&r(be,Object.fromEntries(t.unit.data.map(o=>[o.technology,o[0]||o.units])),!0),r(A,!1),oe()}let Se=_(()=>Array.from({length:e(ze)},(a,t)=>t.toString())),le=[],_e=[],ge=i(0),ke=i(0),ze=i(0);function Le(){if(e($).length==0||e(T).length==0||!y||!X||!ee||!ae||!te)return[];let a={technology:e(T)},t={node:e($)},o=Ae(y.data,a,t,[],!1,"line","").map(k=>({...k,data:k.data.map((d,l)=>({x:l,y:d})),fill:"origin"}));return e(q)?o:[{data:o[0].data.map((k,d)=>({x:d,y:o.reduce((l,x)=>l+x.data[d].y,0)})),label:"Storage level",type:"line",borderColor:"black",fill:"origin",stepped:!0}]}function Ve(){if(e(s)===null||e(A)||e($).length==0||e(T).length==0)return[];if(!y||!X||!ee||!ae||!te)return[];let a={technology:e(T)},t={node:e($)},[o,I,k,d]=[{data:X.data,label_suffix:"_charge",negate:!1},{data:ee.data,label_suffix:"_discharge",negate:!0},{data:ae.data,label_suffix:"_inflow",negate:!1},{data:te.data,label_suffix:"_spillage",negate:!0}].map(({data:l,label_suffix:x,negate:S})=>Ae(l,a,t,[],!1,"line",x).map(g=>({data:g.data.map((u,B)=>({x:B,y:S?-u:u})),label:g.label,type:g.type,stepped:!0,fill:"origin"})));return e(q)?o.concat(I).concat(k).concat(d):[{data:o,label:"Flow Storage Charge",borderColor:"rgb(54, 162, 235)"},{data:I,label:"Flow Storage Discharge",borderColor:"rgb(255, 99, 132)"},{data:k,label:"Flow Storage Inflow",borderColor:"rgb(255, 99, 132)"},{data:d,label:"Flow Storage Spillage",borderColor:"rgb(255, 99, 132)"}].map(({data:l,label:x,borderColor:S})=>l.length===0?null:{data:l[0].data.map((z,u)=>({x:u,y:l.reduce((B,E)=>B+E.data[u].y,0)})),label:x,type:"line",fill:"origin",borderColor:S,backgroundColor:S,stepped:!0}).filter(l=>l!==null)}async function oe(){it(),le=Le(),_e=Ve(),r(ge,le.length,!0),r(ke,_e.length,!0),r(ze,e(ge)>0?le[0].data.length:0,!0),await Pe(),e(G)&&e(G).updateChart(le),e(J)&&e(J).updateChart(_e)}var Ce=St(),Fe=D(b(Ce),2);st(Fe,{children:(a,t)=>{var o=ft(),I=b(o);ve(I,{title:"Solution Selection",children:(l,x)=>{{let S=_(()=>e(A)||e(M));dt(l,{get disabled(){return e(S)},get selected_solution(){return e(s)},set selected_solution(g){r(s,g,!0)},get loading(){return e(M)},set loading(g){r(M,g,!0)},get years(){return e(W)},set years(g){r(W,g,!0)}})}}});var k=D(I,2);{var d=l=>{var x=ct(),S=b(x);ve(S,{title:"Variable Selection",children:(u,B)=>{var E=_t(),H=b(E);ue(H,{label:"Year",content:(p,F=de)=>{{let c=_(()=>me(e(W).map(N=>N.toString()))),h=_(()=>e(A)||e(M));pe(p,{get formId(){return F()},get options(){return e(c)},get disabled(){return e(h)},get value(){return e(w)},set value(N){r(w,N,!0)}})}}});var m=D(H,2);ue(m,{label:"Carrier",content:(p,F=de)=>{{let c=_(()=>me(e(R))),h=_(()=>e(A)||e(M));pe(p,{get formId(){return F()},get options(){return e(c)},get disabled(){return e(h)},get value(){return e(f)},set value(N){r(f,N,!0)}})}}});var C=D(m,2);ue(C,{label:"Smoothing Window Size",content:(p,F=de)=>{{let c=_(()=>me(je)),h=_(()=>e(A)||e(M));pe(p,{get formId(){return F()},get options(){return e(c)},get disabled(){return e(h)},get value(){return e(j)},set value(N){r(j,N,!0)}})}}}),n(u,E)}});var g=D(S,2);{var z=u=>{ve(u,{title:"Data Selection",children:(B,E)=>{var H=gt(),m=b(H);ue(m,{label:"Technology Subdivision",content:(F,c=de)=>{ot(F,{get formId(){return c()},get value(){return e(q)},set value(h){r(q,h,!0)}})}});var C=D(m,2);$e(C,{label:"Technologies",get elements(){return e(V)},get value(){return e(T)},set value(p){r(T,p,!0)}});var Z=D(C,2);$e(Z,{label:"Nodes",get elements(){return e(Q)},get value(){return e($)},set value(p){r($,p,!0)}}),n(B,H)}})};P(g,u=>{e(f)&&e(Q).length>0&&u(z)})}n(l,x)};P(k,l=>{e(s)&&l(d)})}n(a,o)}});var Ne=D(Fe,2),Ze=rt(Ne);{var Ke=a=>{var t=vt();n(a,t)},Oe=a=>{var t=Y(),o=b(t);{var I=d=>{var l=mt();n(d,l)},k=d=>{var l=Y(),x=b(l);{var S=z=>{var u=pt();n(z,u)},g=z=>{var u=Y(),B=b(u);{var E=m=>{var C=ht();n(m,C)},H=m=>{var C=Y(),Z=b(C);{var p=c=>{var h=bt();n(c,h)},F=c=>{var h=Y(),N=b(h);{var Ye=K=>{var ne=yt();n(K,ne)},qe=K=>{var ne=Y(),Ge=b(ne);{var Je=O=>{var se=wt();n(O,se)},Qe=O=>{var se=xt(),De=b(se);Te(Ie(De,{id:"level_chart",type:"line",get labels(){return e(Se)},datasets:[],get options(){return e(Re)},get plot_name(){return e(we)},zoom:!0}),ce=>r(G,ce,!0),()=>e(G));var Ue=D(De,2);Te(Ie(Ue,{id:"flow_chart",type:"line",get labels(){return e(Se)},datasets:[],get options(){return e(Ee)},get plot_name(){return e(Me)},zoom:!0}),ce=>r(J,ce,!0),()=>e(J)),n(O,se)};P(Ge,O=>{e(ke)==0?O(Je):O(Qe,!1)},!0)}n(K,ne)};P(N,K=>{e(ge)==0?K(Ye):K(qe,!1)},!0)}n(c,h)};P(Z,c=>{e(Q).length==0?c(p):c(F,!1)},!0)}n(m,C)};P(B,m=>{e(s)==null?m(E):m(H,!1)},!0)}n(z,u)};P(x,z=>{e(R).length==0?z(S):z(g,!1)},!0)}n(d,l)};P(o,d=>{e(V).length==0?d(I):d(k,!1)},!0)}n(a,t)};P(Ze,a=>{e(M)||e(A)?a(Ke):a(Oe,!1)})}lt(Ne),n(Be,Ce),at()}export{At as component};
