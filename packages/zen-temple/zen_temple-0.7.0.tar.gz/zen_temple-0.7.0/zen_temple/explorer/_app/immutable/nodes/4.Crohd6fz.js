import"../chunks/DsnmJJEf.js";import{o as he}from"../chunks/BIHB8bOP.js";import{p as ye,s as c,b as U,u as R,g as e,d as A,t as ne,e as W,h as D,f as H,a as F,i as we,j as a,k as xe,l as _,n as T,m as ke,r as $e,c as Se}from"../chunks/C2qtcxMB.js";import{i as X,b as ze}from"../chunks/CUUZcSt3.js";import{F as Ne,g as je,a as Ce,r as De,b as le,S as Fe,c as K,t as L,n as Ie}from"../chunks/DZujSHY9.js";import{D as V}from"../chunks/B-RRlO2g.js";import{B as Me}from"../chunks/l0zfogOA.js";import{g as y}from"../chunks/CqS7hfz2.js";import{u as Oe,g as Y}from"../chunks/Bdn9nyjV.js";var Pe=W("<!> <!> <!> <!>",1),Re=W("<!> <!>",1),We=W('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),Be=W('<div class="text-center">No data with this selection.</div>'),Ee=W('<h1 class="mt-2 mb-4">The Energy Balance &ndash; Nodal</h1> <!> <div class="mt-4"><!></div>',1);function Ge(oe,se){ye(se,!0);let Z=null,I=c(null),b=c(!1),v=c(!1),B=c(void 0),w=c(U([])),x=c(U([])),k=c(U([]));const ie=L(["Hourly","Daily","Weekly","Monthly"]);let s=c(null),i=c(null),u=c(null),d=c(null),h=c("Hourly"),ue=_(()=>{if(!e(s)||!e(s).solution_name)return"";let r=e(s).solution_name.split(".");return[r[r.length-1],e(s).scenario_name,"balance",e(u),e(i),e(d)].join("_")}),ee=_(()=>{if(e(I)===null)return"";let r=e(I).data.find(l=>l.carrier===e(u));return r?r[0]||r.units||"":e(I).data[0][0]||e(I).data[0].units||""});const de=_(()=>({animation:!1,normalized:!0,parsing:!1,responsive:!0,borderWidth:1,elements:{point:{radius:0}},scales:{x:{type:"linear",stacked:!0,title:{display:!0,text:"Time"},ticks:{maxRotation:0,autoSkip:!0,callback:r=>Number(r).toFixed(0)},min:0,max:e(s)?.detail?.system.total_hours_per_year},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:`Energy [${e(ee)}]`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"},plugins:{zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x"},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x"},limits:{x:{minRange:10,min:"original",max:"original"}}},decimation:{enabled:!0,algorithm:"min-max"},tooltip:{callbacks:{label:r=>`${r.dataset.label}: ${r.formattedValue} ${e(ee)}`}}}}));R(()=>{e(k),A(()=>{e(k).length>0&&(e(d)==null||!e(k).includes(Number(e(d))))&&a(d,e(k)[0].toString(),!0)})}),R(()=>{e(w),A(()=>{e(w).length>0&&(e(i)==null||!e(w).includes(e(i)))&&a(i,e(w)[0],!0)})}),R(()=>{e(x),A(()=>{e(x).length>0&&(e(u)==null||!e(x).includes(e(u)))&&a(u,e(x)[0],!0)})}),R(()=>{e(s),e(d),e(i),e(u),e(h),A(_e)}),he(()=>{a(d,Y("year")||e(d),!0),a(i,Y("node")||e(i),!0),a(u,Y("carrier")||e(u),!0),a(h,Y("window_size")||e(h),!0)}),R(()=>{e(d),e(i),e(u),e(h),ne().then(()=>{Oe({year:e(d),node:e(i),carrier:e(u),window_size:e(h)})})});let ce=_(()=>({Daily:24,Weekly:168,Monthly:720})[e(h)]||1);async function _e(){e(i)==null||e(u)==null||e(d)==null||e(s)==null||(a(v,!0),await(async r=>{var l=xe(r,2);Z=l[0],a(I,l[1],!0)})(await Promise.all([je(e(s).solution_name,e(i),e(u),e(s).scenario_name,Number(e(d)),e(ce)),Ce(e(s).solution_name,y("flow_export",e(s).version),e(s).scenario_name)])),a(v,!1),pe())}let me=_(()=>Array.from({length:e(G)},(r,l)=>l.toString())),E=[],q=c(0),G=c(0);function ge(){return!e(s)||!e(i)||!e(u)||!e(d)||!Z?[]:Object.entries(Z).flatMap(([r,l])=>{if(!l||!l.data||l.data.length===0)return[];let $={node:[e(i)]};"technology"in l.data[0]&&($={technology:l.data.map(t=>t.technology)});const O=l.data.filter(t=>Object.entries($).every(([n,m])=>m.includes(t[n]))).reduce((t,n)=>{const m=n.technology||n.node||n.label||"";return(t[m]=t[m]||[]).push(n),t},{});return Object.entries(O).map(([t,n])=>({label:t,data:n.reduce((m,o)=>{for(const p in o)!isNaN(Number(o[p]))&&!["year","technology","node","label"].includes(p)&&(m[p]=(m[p]||0)+Number(o[p]));return m},{})})).map(t=>{if(Object.keys(t.data).length==0)return null;const n=e(s).version,m={[y("flow_storage_discharge",n)]:g=>g+" (discharge)",[y("flow_transport_in",n)]:g=>g+" (transport in)",[y("flow_import",n)]:()=>"Import",[y("shed_demand",n)]:()=>"Shed Demand",[y("flow_storage_charge",n)]:g=>g+" (charge)",[y("flow_transport_out",n)]:g=>g+" (transport out)",[y("flow_export",n)]:()=>"Export"};let o=Ie(),p=o,P=Object.values(t.data).map((g,J)=>({x:J,y:g}));return r=="demand"?{data:P,label:"Demand",type:"line",stack:"ownCustomStack",fill:!1,borderColor:"black",backgroundColor:"white",borderWidth:2,stepped:!0,pointRadius:Object.keys(t.data).length==1?2:0}:{data:P,label:m[r]?.(t.label)||t.label,fill:"origin",borderColor:o,backgroundColor:p,stepped:!0,cubicInterpolationMode:"monotone",pointRadius:Object.keys(t.data).length==1?2:0}}).filter(t=>t!==null)})}async function pe(){De(),E=ge(),a(q,E.length,!0),a(G,e(q)>0?E[0].data.length:0,!0),await ne(),e(B)&&e(B).updateChart(E)}var te=Ee(),re=D(H(te),2);Ne(re,{children:(r,l)=>{var $=Re(),M=H($);le(M,{title:"Solution Selection",children:(t,n)=>{{let m=_(()=>e(v)||e(b));Fe(t,{get disabled(){return e(m)},get selected_solution(){return e(s)},set selected_solution(o){a(s,o,!0)},get carriers(){return e(x)},set carriers(o){a(x,o,!0)},get nodes(){return e(w)},set nodes(o){a(w,o,!0)},get years(){return e(k)},set years(o){a(k,o,!0)},get loading(){return e(b)},set loading(o){a(b,o,!0)}})}}});var O=D(M,2);{var f=t=>{le(t,{title:"Data Selection",children:(n,m)=>{var o=Pe(),p=H(o);K(p,{label:"Year",content:(S,z=T)=>{{let N=_(()=>L(e(k).map(C=>C.toString()))),j=_(()=>e(v)||e(b));V(S,{get formId(){return z()},get options(){return e(N)},get disabled(){return e(j)},get value(){return e(d)},set value(C){a(d,C,!0)}})}}});var P=D(p,2);K(P,{label:"Node",content:(S,z=T)=>{{let N=_(()=>L(e(w))),j=_(()=>e(v)||e(b));V(S,{get formId(){return z()},get options(){return e(N)},get disabled(){return e(j)},get value(){return e(i)},set value(C){a(i,C,!0)}})}}});var g=D(P,2);K(g,{label:"Carrier",content:(S,z=T)=>{{let N=_(()=>L(e(x))),j=_(()=>e(v)||e(b));V(S,{get formId(){return z()},get options(){return e(N)},get disabled(){return e(j)},get value(){return e(u)},set value(C){a(u,C,!0)}})}}});var J=D(g,2);K(J,{label:"Smoothing Window Size",content:(S,z=T)=>{{let N=_(()=>e(v)||e(b));V(S,{get formId(){return z()},get options(){return ie},get disabled(){return e(N)},get value(){return e(h)},set value(j){a(h,j,!0)}})}}}),F(n,o)}})};X(O,t=>{!e(b)&&e(s)&&t(f)})}F(r,$)}});var ae=D(re,2),fe=ke(ae);{var be=r=>{var l=We();F(r,l)},ve=r=>{var l=Se(),$=H(l);{var M=f=>{var t=Be();F(f,t)},O=f=>{{let t=_(()=>e(G)==1?"bar":"line");ze(Me(f,{get type(){return e(t)},get options(){return e(de)},get labels(){return e(me)},datasets:[],get plot_name(){return e(ue)},zoom:!0}),n=>a(B,n,!0),()=>e(B))}};X($,f=>{e(q)==0?f(M):f(O,!1)},!0)}F(r,l)};X(fe,r=>{e(v)?r(be):r(ve,!1)})}$e(ae),F(oe,te),we()}export{Ge as component};
