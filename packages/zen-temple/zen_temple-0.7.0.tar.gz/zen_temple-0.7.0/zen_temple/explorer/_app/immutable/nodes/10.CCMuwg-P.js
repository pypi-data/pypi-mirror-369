import"../chunks/DsnmJJEf.js";import{o as qe}from"../chunks/BIHB8bOP.js";import{p as Ge,s as l,b as S,u as q,j as a,g as e,l as i,t as He,e as y,h,f as $,a as _,i as Je,n as U,m as Ke,r as Qe,c as Se}from"../chunks/C2qtcxMB.js";import{i as f}from"../chunks/CUUZcSt3.js";import{F as Ue,e as de,b as _e,S as We,c as W,h as Xe,a as Ze,t as et,r as tt,f as $e,i as at}from"../chunks/DZujSHY9.js";import{T as Ee,A as X}from"../chunks/CpAjmBpr.js";import{R as Oe}from"../chunks/DZhPVe1c.js";import{B as rt}from"../chunks/l0zfogOA.js";import{g as p}from"../chunks/CqS7hfz2.js";import{u as nt,g as Pe}from"../chunks/Bdn9nyjV.js";var lt=y("<!> <!>",1),ot=y("<!> <!>",1),st=y("<!> <!> <!>",1),it=y("<!> <!>",1),ut=y("<!> <!> <!>",1),ct=y('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),dt=y('<div class="text-center">No solution selected</div>'),_t=y('<div class="text-center">No data with this selection.</div>'),vt=y('<h1 class="mt-2 mb-4">The Transition Pathway &ndash; Emissions</h1> <!> <div class="mt-4"><!></div>',1);function St(ke,Ce){Ge(Ce,!0);let E=l(null),v=l(null),Z=l(null),ee=l(null),te=l(null),O=l(null),ve=l(S({})),me=l(S({})),P=l(!1),F=l(!1),ge=l(S([])),w=l(S([]));const Te=[{label:"Location",value:"location"},{label:"Technology & Carrier",value:"technology_carrier"}],Fe=["Annual","Cumulative"];let r=l(null),u=l(!0),b=l("Annual"),G=l(S([])),H=l(S([])),V=l("location"),k=l(!1),J=l(S([])),B=l(S([])),we=i(()=>{if(!e(r)?.solution_name)return"";let t=e(r).solution_name.split(".");return[t[t.length-1],e(r).scenario_name,e(ae)].join("_")}),fe=i(()=>e(u)?Object.values(e(ve))[0]||"":Object.values(e(me))[0]||""),Be=i(()=>({responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:"Emissions"+(e(k)?"":` [${e(fe)}]`)},max:e(k)?1:void 0,suggestedMin:e(k)?-1:void 0}},plugins:{tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue}`+(e(k)?"":` ${e(fe)}`)}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}})),ae=i(()=>e(u)?p("carbon_emissions_carrier",e(r)?.version):e(b)=="Annual"?p("carbon_emissions_annual",e(r)?.version):p("carbon_emissions_cumulative",e(r)?.version)),K=i(()=>e(E)?.data?de(e(E).data.map(t=>t.technology)):[]),Q=i(()=>e(v)?.data?de(e(v).data.map(t=>t.carrier)):[]),re=i(()=>!e(E)?.data&&!e(v)?.data?[]:de([...e(E)?.data||[],...e(v)?.data||[]].map(t=>t.location)));q(()=>{a(H,e(K),!0)}),q(()=>{a(G,e(Q),!0)}),q(()=>{a(J,e(re),!0)}),q(()=>{a(B,e(w),!0)}),qe(()=>{let t=Pe("subdivision");a(u,t!==null?t==="true":e(u),!0),a(b,Pe("cumulation")||e(b),!0)}),q(()=>{e(u),e(b),He().then(()=>{nt({subdivision:e(u)?"true":"false",cumulation:e(b)})})});function Ie(){Le()}async function Le(){if(e(r)===null)return;a(F,!0);const t={technology:p("carbon_emissions_technology",e(r).version),carrier:p("carbon_emissions_carrier",e(r).version),annual_limit:p("carbon_emissions_annual_limit",e(r).version),budget:p("carbon_emissions_budget",e(r).version),annual:p("carbon_emissions_annual",e(r).version),cumulative:p("carbon_emissions_cumulative",e(r).version)};let[n,c]=await Promise.all([Xe(e(r).solution_name,Object.values(t),e(r).scenario_name,t.carrier),Ze(e(r).solution_name,t.annual,e(r).scenario_name)]);if(a(E,n[t.technology],!0),a(v,n[t.carrier],!0),a(te,n[t.annual_limit],!0),a(O,n[t.budget],!0),a(Z,n[t.annual],!0),a(ee,n[t.cumulative],!0),e(v)?.data&&(e(v).data=e(v).data.map(o=>({...o,location:o.location||o.node}))),e(O)&&e(O).data.length>0){const o=Number(Object.values(e(O).data[0])[0]);e(O).data[0]=Object.fromEntries(e(w).map(I=>[I,o]))}n.unit?.data&&a(ve,Object.fromEntries(n.unit.data.map(o=>[o.carrier,o[0]||o.units])),!0),c.data&&a(me,Object.fromEntries(c.data.map(o=>[o.carrier,o[0]||o.units])),!0),a(F,!1)}let pe=i(()=>e(u)?e(V)=="location"?{technology_carrier:e(K).concat(e(Q))}:{location:e(re)}:{}),be=i(()=>e(u)?e(V)=="location"?{location:e(J)}:{technology_carrier:e(H).concat(e(G))}:{}),he=i(()=>e(w).filter(t=>!e(B).includes(t))),Ne=i(()=>{if(e(r)===null||!e(Z)?.data||!e(ee)?.data||!e(v)?.data||!e(E)?.data)return[];let t;e(u)?t=e(v).data.map(c=>({...c,technology_carrier:c.carrier})).concat(e(E).data.map(c=>({...c,technology_carrier:c.technology}))):e(b)=="Annual"?t=e(Z).data:t=e(ee).data,tt();const n=$e(t,e(pe),e(be),e(he));return n.length==1&&(n[0].label=e(ae)),e(k)?at(n):n}),ze=i(()=>{if(e(r)===null||e(te)===null||e(O)===null)return[];let t=null;if(e(ae)==p("carbon_emissions_annual",e(r)?.version)?t=e(te).data:t=e(O).data,t==null||t?.length==0)return[];let n=$e(t,e(pe),e(be),e(he));return n.length==0?[]:(n[0].label=e(b)=="Annual"?"Annual Emissions Limit":"Carbon Emissions Budget",n[0].type="line",n)}),ye=i(()=>e(Ne).concat(e(ze)));var xe=vt(),je=h($(xe),2);Ue(je,{children:(t,n)=>{var c=ut(),o=$(c);_e(o,{title:"Solution Selection",children:(d,N)=>{{let m=i(()=>e(F)||e(P));We(d,{get disabled(){return e(m)},solution_selected:Ie,get selected_solution(){return e(r)},set selected_solution(s){a(r,s,!0)},get nodes(){return e(ge)},set nodes(s){a(ge,s,!0)},get years(){return e(w)},set years(s){a(w,s,!0)},get loading(){return e(P)},set loading(s){a(P,s,!0)}})}}});var I=h(o,2);{var x=d=>{_e(d,{title:"Variable Selection",children:(N,m)=>{var s=lt(),C=$(s);W(C,{label:"Subdivision",content:(Y,z=U)=>{Ee(Y,{get formId(){return z()},get value(){return e(u)},set value(R){a(u,R,!0)}})}});var le=h(C,2);{var oe=g=>{W(g,{label:"Cumulation",content:(z,R=U)=>{{let se=i(()=>et(Fe)),ie=i(()=>e(F)||e(P));Oe(z,{get formId(){return R()},get options(){return e(se)},get disabled(){return e(ie)},get value(){return e(b)},set value(ue){a(b,ue,!0)}})}}})};f(le,g=>{e(u)||g(oe)})}_(N,s)}})};f(I,d=>{!e(P)&&e(r)&&d(x)})}var L=h(I,2);{var ne=d=>{_e(d,{title:"Data Selection",children:(N,m)=>{var s=it(),C=$(s);{var le=g=>{var Y=st(),z=$(Y);W(z,{label:"Aggregation",content:(A,M=U)=>{Oe(A,{get formId(){return M()},get options(){return Te},get value(){return e(V)},set value(D){a(V,D,!0)}})}});var R=h(z,2);W(R,{label:"Normalization",content:(A,M=U)=>{Ee(A,{get formId(){return M()},get value(){return e(k)},set value(D){a(k,D,!0)}})}});var se=h(R,2);{var ie=j=>{X(j,{label:"Locations",get elements(){return e(re)},get value(){return e(J)},set value(A){a(J,A,!0)}})},ue=j=>{var A=ot(),M=$(A);{var D=T=>{X(T,{label:"Technologies",get elements(){return e(K)},get value(){return e(H)},set value(ce){a(H,ce,!0)}})};f(M,T=>{e(K).length>0&&T(D)})}var Ye=h(M,2);{var De=T=>{X(T,{label:"Carriers",get elements(){return e(Q)},get value(){return e(G)},set value(ce){a(G,ce,!0)}})};f(Ye,T=>{e(Q).length>0&&T(De)})}_(j,A)};f(se,j=>{e(V)=="location"?j(ie):j(ue,!1)})}_(g,Y)};f(C,g=>{e(u)&&g(le)})}var oe=h(C,2);X(oe,{label:"Years",get elements(){return e(w)},get value(){return e(B)},set value(g){a(B,g,!0)}}),_(N,s)}})};f(L,d=>{!e(P)&&e(r)&&!e(F)&&d(ne)})}_(t,c)}});var Ae=h(je,2),Re=Ke(Ae);{var Me=t=>{var n=ct();_(t,n)},Ve=t=>{var n=Se(),c=$(n);{var o=x=>{var L=dt();_(x,L)},I=x=>{var L=Se(),ne=$(L);{var d=m=>{var s=_t();_(m,s)},N=m=>{{let s=i(()=>e(B).map(C=>C.toString()));rt(m,{type:"bar",get options(){return e(Be)},get labels(){return e(s)},get datasets(){return e(ye)},get plot_name(){return e(we)}})}};f(ne,m=>{e(ye).length==0||e(B).length==0?m(d):m(N,!1)},!0)}_(x,L)};f(c,x=>{e(r)==null?x(o):x(I,!1)},!0)}_(t,n)};f(Re,t=>{e(P)||e(F)?t(Me):t(Ve,!1)})}Qe(Ae),_(ke,xe),Je()}export{St as component};
