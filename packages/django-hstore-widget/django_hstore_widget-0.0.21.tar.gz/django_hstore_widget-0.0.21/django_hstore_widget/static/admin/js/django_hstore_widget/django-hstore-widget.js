import{p as t,H as e,h as s,a as i,F as n}from"./index.js";const r=(...t)=>((...t)=>t.filter((t=>t&&"string"==typeof t)).join(" "))(...t);var o,a,l,c,h,d,u,p,f,m,y,g=function(t,e,s,i){if("a"===s&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?i:"a"===s?i.call(t):i?i.value:e.get(t)};const w=Object.freeze({input:"vTextField",textarea:"vLargeTextField"}),x=t(class extends e{constructor(){super(),this.__registerHost(),this.__attachShadow(),o.add(this),this.textareaElement=null,this.cols=40,this.rows=10,this.delete_svg_src=void 0,this.add_svg_src=void 0,this.edit_svg_src=void 0,this.mounted=!1,this.error=null,this.textarea_value="",this.output_render_type="rows",this.__json=[]}async jsonWatcher(t){await g(this,o,"m",c).call(this,t)}async __jsonWatcher(){this.textareaElement&&(this.textareaElement.value=g(this,o,"m",l).call(this,{indent:0})),"rows"===this.output_render_type&&(console.log("Updated in background"),this.textarea_value=g(this,o,"m",l).call(this,{indent:0}))}async createHiddenTextarea(){this.textareaElement=document.createElement("textarea"),this.textareaElement.style.display="none",this.textareaElement.name=this.field_name,this.el.appendChild(this.textareaElement)}async connectedCallback(){await g(this,o,"m",c).call(this,this.json),this.mounted=!this.error}async componentDidLoad(){requestAnimationFrame((async()=>{await this.createHiddenTextarea()}))}render(){return this.mounted?s(i,null,s("div",{class:"flex gap-2.5 items-center"},s("textarea",{class:r("rows"===this.output_render_type&&"hidden invisible",this.error&&"warning",w.textarea),cols:this.cols,rows:this.rows,onInput:g(this,o,"m",p).bind(this),value:this.textarea_value}),s("div",{class:r("warning brightness-90",this.error||"invisible"),id:"textbox_error"},this.error)),"rows"===this.output_render_type&&!this.error&&this.__json&&s(n,null,this.__json.map((t=>g(this,o,"m",m).call(this,t)))),s("div",{class:"form-row justify-between items-center flex"},s("button",{type:"button",class:r("items-center select-none justify-center flex gap-1 cursor-pointer","rows"===this.output_render_type||"invisible"),id:"add-button","aria-label":"Add Row",onClick:g(this,o,"m",d).bind(this)},g(this,o,"m",y).call(this,{type:"add"}),"Add row"),s("div",{class:r("items-center select-none justify-center flex gap-1",this.error?"opacity-60":"cursor-pointer"),id:"textarea_open_close_toggle"},"textarea"===this.output_render_type?s("button",{type:"button",class:"items-center select-none justify-center flex gap-1 cursor-pointer","aria-label":"Close TextArea",onClick:g(this,o,"m",u).bind(this)},g(this,o,"m",y).call(this,{type:"delete"}),"Close TextArea"):"rows"===this.output_render_type?s("button",{type:"button",class:"items-center select-none justify-center flex gap-1 cursor-pointer","aria-label":"Open TextArea",onClick:g(this,o,"m",u).bind(this)},g(this,o,"m",y).call(this,{type:"edit"}),"Open TextArea"):s("div",{class:"flex items-center justify-center w-full gap-1"},s("p",null,"Output render type is "),s("code",{class:"warning curosr-default"},this.output_render_type),s("p",null,"which doesn't fall in"),s("code",{class:"warning curosr-default"},"rows"),s("p",null,"or"),s("code",{class:"warning curosr-default"},"textarea"),s("p",null,"Please ",s("a",{href:g(this,o,"a",a)},"file an issue at Github")))))):s(i,null,s("div",{class:"flex items-center justify-center gap-1",id:"mount_error"},s("p",null,"Failed to mount. Unexpected JSON from ",s("code",null,"django backend")),s("p",null,"The provided json is: ",s("code",{class:"warning"},this.json)," which is not valid."),s("p",null,"Please check the json or ",s("a",{href:g(this,o,"a",a)},"file an issue at Github"))))}get el(){return this}static get watchers(){return{json:["jsonWatcher"],__json:["__jsonWatcher"]}}static get style(){return"button{all:unset}.min-width-\\[150px\\]{min-width:150px}.min-width-\\[300px\\]{min-width:300px}.flex{display:flex}.hidden{display:none}.select-none{user-select:none}.justify-center{justify-content:center}.justify-start{justify-content:flex-start}.justify-between{justify-content:space-between}.items-center{align-items:center}.flex-col{flex-direction:column}.invisible{visibility:hidden}.gap-1{gap:0.25rem;}.gap-2\\.5{gap:0.625rem;}.opacity-60{opacity:0.6}.cursor-pointer{cursor:pointer}.cursor-default{cursor:default}.brightness-90{filter:brightness(0.9)}.warning{color:var(--error-fg, red);border-color:var(--error-fg, red)}"}},[257,"django-hstore-widget",{json:[513],field_name:[513],cols:[514],rows:[514],delete_svg_src:[1],add_svg_src:[1],edit_svg_src:[1],mounted:[32],error:[32],textarea_value:[32],output_render_type:[32],__json:[32]},void 0,{json:["jsonWatcher"],__json:["__jsonWatcher"]}]);function b(){"undefined"!=typeof customElements&&["django-hstore-widget"].forEach((t=>{"django-hstore-widget"===t&&(customElements.get(t)||customElements.define(t,x))}))}o=new WeakSet,a=function(){return"https://github.com/baseplate-admin/django-hstore-widget/issues"},l=function({indent:t}={}){const e=this.__json.reduce(((t,e)=>((e.key||e.value)&&(t[e.key??""]=e.value??""),t)),{});return void 0===t&&(t=Object.keys(e).length>1?4:0),globalThis.JSON.stringify(e,null,t)},c=async function(t){try{const e=globalThis.JSON.parse(t);this.__json=Object.keys(e).map(((t,s)=>({key:t,value:e[t],index:s}))),this.error=null}catch(t){this.error=t instanceof Error?""+t:"An unknown error occurred"}finally{this.__json=globalThis.structuredClone(this.__json)}},h=async function(t){this.__json=this.__json.filter((e=>e.index!==t))},d=async function(){const t=this.__json.at(-1);this.__json.push({index:t?t.index+1:0,key:"",value:""}),this.__json=globalThis.structuredClone(this.__json)},u=async function(){this.error||("rows"===this.output_render_type?(this.output_render_type="textarea",this.textarea_value=g(this,o,"m",l).call(this)):"textarea"===this.output_render_type?this.output_render_type="rows":console.error("Something is wrong with 'output_render_type'. It is "+this.output_render_type))},p=async function(t){const e=t.currentTarget;g(this,o,"m",c).call(this,e.value||"{}"),this.__json.forEach((t=>{"object"==typeof t.value&&(this.error="SyntaxError: 'ltree' doesn't support nested json")}))},f=async function(t,e,s){const i=t.currentTarget.value;"key"===s?e.key=i:"value"===s&&(e.value=i),this.__json=globalThis.structuredClone(this.__json)},m=function(t){return s("div",{class:"form-row field-data",id:"json_items"},s("div",{class:"flex gap-2.5 items-center justify-start"},s("input",{value:t.key,onInput:e=>g(this,o,"m",f).call(this,e,t,"key"),placeholder:"key",class:r("min-width-[150px]",w.input)}),s("strong",null,":"),s("input",{value:t.value,onInput:e=>g(this,o,"m",f).call(this,e,t,"value"),placeholder:"value",class:r("min-width-[300px]",w.input)}),s("div",{role:"button","aria-label":`Delete ${t.key}:${t.value} at index ${t.index}`,class:"items-center justify-center flex cursor-pointer select-none",id:"delete-button",onClick:g(this,o,"m",h).bind(this,t.index)},g(this,o,"m",y).call(this,{type:"delete"}))))},y=function({type:t}){const e={delete:{src:this.delete_svg_src,alt:"❌"},add:{src:this.add_svg_src,alt:"➕"},edit:{src:this.edit_svg_src,alt:"✏️"}}[t];if(!e)throw Error(`Icon type "${t}" is not defined in the mapping.`);return s("img",{src:e.src,alt:e.alt})},b();const j=x,v=b;export{j as DjangoHstoreWidget,v as defineCustomElement}