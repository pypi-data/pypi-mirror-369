import{p as t,H as e,h as n,a as s,F as i}from"./index.js";import{d as r,s as o}from"./p-O_Ks0dGm.js";const a=(...t)=>((...t)=>t.filter((t=>t&&"string"==typeof t)).join(" "))(...t);var l,c,h,d,u,p,f,m,g,y,w=function(t,e,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(t):s?s.value:e.get(t)};const x=Object.freeze({input:"vTextField",textarea:"vLargeTextField"}),b=t(class extends e{constructor(){super(),this.__registerHost(),l.add(this),this.cols=40,this.rows=10,this.delete_svg_src=void 0,this.add_svg_src=void 0,this.edit_svg_src=void 0,this.mounted=!1,this.error=null,this.textarea_value="",this.output_render_type="rows",this.__json=[]}async jsonWatcher(t){await w(this,l,"m",d).call(this,t)}async __jsonWatcher(){console.debug("Updating __json state",this.__json),this.textarea_value=w(this,l,"m",h).call(this,{indent:0})}async componentWillLoad(){["delete_svg_src","add_svg_src","edit_svg_src"].forEach((t=>{this[t]&&(o[t]=this[t])}))}async componentDidLoad(){globalThis.requestAnimationFrame((async()=>{await w(this,l,"m",d).call(this,this.json),this.mounted=!this.error}))}render(){return this.mounted?n(s,null,n("div",{class:"flex gap-2.5 items-center"},n("textarea",{class:a("rows"===this.output_render_type&&"hidden invisible",this.error&&"warning",x.textarea),cols:this.cols,name:this.field_name,rows:this.rows,onInput:w(this,l,"m",m).bind(this),value:this.textarea_value}),n("div",{class:a("warning brightness-90",this.error||"invisible"),id:"textbox_error"},this.error)),"rows"===this.output_render_type&&!this.error&&this.__json&&n(i,null,this.__json.map((t=>w(this,l,"m",y).call(this,t)))),n("div",{class:"form-row justify-between items-center flex"},n("button",{type:"button",class:a("items-center select-none justify-center flex gap-1 cursor-pointer","rows"===this.output_render_type||"invisible"),id:"add-button","aria-label":"Add Row",onClick:w(this,l,"m",p).bind(this)},n("image-icon",{type:"add"}),"Add row"),n("div",{class:a("items-center select-none justify-center flex gap-1",this.error?"opacity-60":"cursor-pointer"),id:"textarea_open_close_toggle"},"textarea"===this.output_render_type?n("button",{type:"button",class:"items-center select-none justify-center flex gap-1 cursor-pointer","aria-label":"Close TextArea",onClick:w(this,l,"m",f).bind(this)},n("image-icon",{type:"delete"}),"Close TextArea"):"rows"===this.output_render_type?n("button",{type:"button",class:"items-center select-none justify-center flex gap-1 cursor-pointer","aria-label":"Open TextArea",onClick:w(this,l,"m",f).bind(this)},n("image-icon",{type:"edit"}),"Open TextArea"):n("div",{class:"flex items-center justify-center w-full gap-1"},n("p",null,"Output render type is "),n("code",{class:"warning curosr-default"},this.output_render_type),n("p",null,"which doesn't fall in"),n("code",{class:"warning curosr-default"},"rows"),n("p",null,"or"),n("code",{class:"warning curosr-default"},"textarea"),n("p",null,"Please ",n("a",{href:w(this,l,"a",c)},"file an issue at Github")))))):n(s,null,n("div",{class:"flex items-center justify-center gap-1",id:"mount_error"},n("p",null,"Failed to mount. Unexpected JSON from ",n("code",null,"django backend")),n("p",null,"The provided json is: ",n("code",{class:"warning"},this.json)," which is not valid."),n("p",null,"Please check the json or ",n("a",{href:w(this,l,"a",c)},"file an issue at Github"))))}static get watchers(){return{json:["jsonWatcher"],__json:["__jsonWatcher"]}}static get style(){return"django-hstore-widget {\n    button {\n        all: unset;\n    }\n\n    /* Arbitrary min-width */\n    .min-width-\\[150px\\] {\n        min-width: 150px;\n    }\n\n    .min-width-\\[300px\\] {\n        min-width: 300px;\n    }\n\n    /* Display types */\n    .flex {\n        display: flex;\n    }\n\n    .hidden {\n        display: none;\n    }\n\n    /* User Select */\n    .select-none {\n        user-select: none;\n    }\n\n    /* Justify Items */\n    .justify-center {\n        justify-content: center;\n    }\n\n    .justify-start {\n        justify-content: flex-start;\n    }\n\n    .justify-between {\n        justify-content: space-between;\n    }\n\n    /* Align items */\n    .items-center {\n        align-items: center;\n    }\n\n    /* Flex Direction */\n    .flex-col {\n        flex-direction: column;\n    }\n\n    /* Visibility */\n    .invisible {\n        visibility: hidden;\n    }\n\n    /* Gaps */\n    .gap-1 {\n        gap: 0.25rem; /* 4px */\n    }\n\n    .gap-2\\.5 {\n        gap: 0.625rem;\n        /* 10px */\n    }\n\n    /* Opacity */\n    .opacity-60 {\n        opacity: 0.6;\n    }\n\n    /* Cursor types */\n    .cursor-pointer {\n        cursor: pointer;\n    }\n\n    .cursor-default {\n        cursor: default;\n    }\n\n    /* Brightness */\n    .brightness-90 {\n        filter: brightness(0.9);\n    }\n\n    /* Colors */\n    .warning {\n        color: var(--error-fg, red);\n        border-color: var(--error-fg, red);\n    }\n}"}},[256,"django-hstore-widget",{json:[513],field_name:[513],cols:[514],rows:[514],delete_svg_src:[1],add_svg_src:[1],edit_svg_src:[1],mounted:[32],error:[32],textarea_value:[32],output_render_type:[32],__json:[32]},void 0,{json:["jsonWatcher"],__json:["__jsonWatcher"]}]);function j(){"undefined"!=typeof customElements&&["django-hstore-widget","image-icon"].forEach((t=>{switch(t){case"django-hstore-widget":customElements.get(t)||customElements.define(t,b);break;case"image-icon":customElements.get(t)||r()}}))}l=new WeakSet,c=function(){return"https://github.com/baseplate-admin/django-hstore-widget/issues"},h=function({indent:t}={}){const e=this.__json.reduce(((t,e)=>((e.key||e.value)&&(t[e.key??""]=e.value??""),t)),{});return void 0===t&&(t=Object.keys(e).length>1?4:0),globalThis.JSON.stringify(e,null,t)},d=async function(t){try{const e=globalThis.JSON.parse(t);this.__json=Object.keys(e).map(((t,n)=>({key:t,value:e[t],index:n}))),this.error=null}catch(t){this.error=t instanceof Error?""+t:"An unknown error occurred"}finally{this.__json=globalThis.structuredClone(this.__json)}},u=async function(t){this.__json=this.__json.filter((e=>e.index!==t))},p=async function(){const t=this.__json.at(-1);this.__json.push({index:t?t.index+1:0,key:"",value:""}),this.__json=globalThis.structuredClone(this.__json)},f=async function(){this.error||("rows"===this.output_render_type?(this.output_render_type="textarea",this.textarea_value=w(this,l,"m",h).call(this)):"textarea"===this.output_render_type?this.output_render_type="rows":console.error("Something is wrong with 'output_render_type'. It is "+this.output_render_type))},m=async function(t){const e=t.currentTarget;w(this,l,"m",d).call(this,e.value||"{}"),this.__json.forEach((t=>{"object"==typeof t.value&&(this.error="SyntaxError: 'ltree' doesn't support nested json")}))},g=async function(t,e,n){const s=t.currentTarget.value;"key"===n?e.key=s:"value"===n&&(e.value=s),this.__json=globalThis.structuredClone(this.__json)},y=function(t){return n("div",{class:"form-row field-data",id:"json_items"},n("div",{class:"flex gap-2.5 items-center justify-start"},n("input",{value:t.key,onInput:e=>w(this,l,"m",g).call(this,e,t,"key"),placeholder:"key",class:a("min-width-[150px]",x.input)}),n("strong",null,":"),n("input",{value:t.value,onInput:e=>w(this,l,"m",g).call(this,e,t,"value"),placeholder:"value",class:a("min-width-[300px]",x.input)}),n("div",{role:"button","aria-label":`Delete ${t.key}:${t.value} at index ${t.index}`,class:"items-center justify-center flex cursor-pointer select-none",id:"delete-button",onClick:w(this,l,"m",u).bind(this,t.index)},n("image-icon",{type:"delete"}))))},j();const v=b,_=j;export{v as DjangoHstoreWidget,_ as defineCustomElement}