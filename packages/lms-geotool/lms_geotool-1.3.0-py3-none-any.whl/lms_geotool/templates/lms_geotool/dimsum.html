<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>线面求和</title>
    {% include "common.html" %}
</head>
<body>
<div id="dimsum">
    <h3>线面求和</h3>
    <el-divider></el-divider>
    <form class="dimsum-form" method="post" action="{% url 'dimsum' %}">
        {% csrf_token %}
        <el-row :gutter="20">
            <el-col :span="12">
                <el-card>
                    <template #header>
                        <div class="title">
                            <h4>原始数据</h4>
                            <el-select v-model="form.inputChoose" placeholder="请选择计算类型" style="width: 180px">
                                <el-option v-for="(each,index) in options"
                                           :key="index"
                                           :label="each.label"
                                           :value="each.value"
                                           :disabled="each.value === form.outputChoose">
                                </el-option>

                            </el-select>
                            <!-- 隐藏字段 -->
                            <input type="hidden" name="input_choose" :value="form.inputChoose">
                        </div>
                    </template>
                    <el-input v-model="form.inputArea"
                              name="input_area"
                              type="textarea"
                              resize="none"
                              placeholder="输入坐标数据，以中英文逗号分隔，换行输入多点位"
                              @blur.prevent="formatData()"
                    >
                    </el-input>
                </el-card>
            </el-col>
            <el-col :span="12">
                <el-card>
                    <template #header>
                        <div class="title">
                            <h4>计算结果</h4>
                        </div>
                    </template>
                    <el-input v-model="form.outputArea"
                              name="output_area"
                              type="textarea"
                              resize="none"
                              placeholder="输出结果"
                              readonly>
                    </el-input>
{#                    <template #footer>#}
{#                        <div>123</div>#}
{#                    </template>#}
                </el-card>
            </el-col>
        </el-row>
    </form>
    <el-divider></el-divider>
    <div class="footer">
        <el-button size="large" type="success" v-if="form.inputChoose && form.inputArea" @click="dimsum">计算</el-button>
        <el-button size="large" v-else type="info">计算</el-button>

        <el-button size="large" type="danger" v-if="form.inputChoose || form.inputArea || form.outputArea" @click="clear">重置</el-button>
        <el-button size="large" v-else type="info">重置</el-button>
    </div>
    {% verbatim row_num %}
        <div v-if="rowNum!==0" class="total">共{{ rowNum }}条数据</div>
    {% endverbatim row_num %}
</div>


</body>
</html>

<script>
    const {createApp, ref, reactive, watch} = Vue
    const App = {
        setup() {
            const options = [
                {label: "连续点测距", value: "1"},
                {label: "多边形面积", value: "2"},
            ];
            const form = reactive({
                inputChoose: '{{ input_choose }}',
                inputArea: '{{ input_area }}'.replaceAll("&quot;", "").replaceAll("&#x27;", ""),
                outputArea: '{{ output_area }}'.replaceAll("&quot;", "").replaceAll("&#x27;", "")
            })
            const rowNum = ref(0);
            /**
             * 清空
             */
            const clear = () => {
                if (confirm("是否要重置当前页面的数据")) {
                    form.inputChoose = "";
                    form.outputChoose = "";
                    form.inputArea = "";
                    form.outputArea = "";
                    rowNum.value = 0;
                }
            }

            /**
             * 提交
             */
            const dimsum = () => {
                formatData()
                let forms = document.getElementsByClassName('dimsum-form')[0];
                forms && forms.submit();
            }

            watch(() => form.inputArea, () => {
                //连续换行的情况和中文逗号过滤
                form.inputArea = form.inputArea.replaceAll("\n\n", "\n").replaceAll("，", ",");
                rowNum.value = form.inputArea ? form.inputArea.split("\n").length : 0;
            })

            const formatData = () => {
                form.inputArea = form.inputArea.replace(/^\n|\n$/g, '');
            }

            return {
                form,
                rowNum,
                options,
                clear,
                dimsum,
                formatData
            }
        }
    }

    const app = createApp(App)
    app.use(ElementPlus, {
        locale: ElementPlusLocaleZhCn,
    })
    app.mount('#dimsum')
</script>

<style>
    #dimsum {
        text-align: center;
        width: 95%;
        margin: auto;
        height: 95vh;
    }

    /*坐标系标题*/
    .title {
        height: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }


    .el-textarea {
        width: 100%;
        background: #f3f5f7;
        border: none;

        font-size: 20px;
        color: #000000;
        line-height: 30px;
    }

    .el-textarea__inner {
        background-color: #f3f5f7;
        text-align: center;
    }
    [name="input_area"]{
        height: calc(95vh - 300px);
    }
    [name="output_area"]{
        height: calc(95vh - 300px);
    }
</style>
