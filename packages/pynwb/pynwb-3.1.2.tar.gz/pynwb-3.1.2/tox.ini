# Tox (https://tox.readthedocs.io/) is a tool for running tests
# in multiple virtualenvs. This configuration file will run the
# test suite on all supported python versions. To use it, "pip install tox"
# and then run "tox" from this directory.

[tox]
envlist = test-py{39,310,311,312,313}-pinned
requires = pip >= 22.0

[testenv]
download = True
setenv =
    PYTHONDONTWRITEBYTECODE = 1
    VIRTUALENV_PIP = 23.3.1
install_command =
    pinned, minimum, wheelinstall: python -m pip install {opts} {packages}
    upgraded:                      python -m pip install -U {opts} {packages}
    prerelease:                    python -m pip install -U --pre {opts} {packages}
deps =
    # use pinned, minimum, or neither (use dependencies in pyproject.toml)
    test, gallery, build:   -rrequirements-dev.txt
    gallery:                -rrequirements-doc.txt
    optional:               -rrequirements-opt.txt
    pinned:                 -rrequirements.txt
    minimum:                -rrequirements-min.txt
commands =
    python --version     # print python version for debugging
    python -m pip check  # check for conflicting packages
    python -m pip list   # list installed packages for debugging
    test:         python test.py -v
    gallery:      python test.py --example
    build:        python -m pip install -U build
    build:        python -m build
    wheelinstall: python -c "import pynwb"

# list of pre-defined environments.
[testenv:test-py313-upgraded]
[testenv:test-py313-prerelease]
[testenv:test-py311-optional-pinned]  # some optional reqs not compatible with py312 yet
[testenv:test-py{39,310,311,312,313}-pinned]
[testenv:test-py39-minimum]

[testenv:gallery-py313-upgraded]
[testenv:gallery-py313-prerelease]
[testenv:gallery-py311-optional-pinned]
[testenv:gallery-py{39,310,311,312,313}-pinned]
[testenv:gallery-py39-minimum]

[testenv:build-py313-upgraded]
[testenv:build-py313-prerelease]
[testenv:build-py{39,310,311,312,313}-pinned]  # using tox for this so that we can have a clean build environment
[testenv:build-py39-minimum]

[testenv:wheelinstall]  # use with `--installpkg dist/*-none-any.whl`
