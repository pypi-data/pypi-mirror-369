import{g as G,p as C,be as Y,w as A,D as j,E as T,I as J,G as oe,P as Q,m as se,s as I,e as W,x as X,c as E,f as Z,cX as ue,cq as ce,d as H,R as ie,cx as fe,c1 as ve,af as de,z as me,u as he,F as ge,a as _,ag as pe,ah as ye,ai as Se,o as we,cY as Ve}from"./index-BGgfaO08.js";const Te=C({renderless:Boolean,...Q()},"VVirtualScrollItem"),Ie=G()({name:"VVirtualScrollItem",inheritAttrs:!1,props:Te(),emits:{"update:height":a=>!0},setup(a,n){let{attrs:c,emit:r,slots:t}=n;const{resizeRef:s,contentRect:f}=Y(void 0,"border");A(()=>{var i;return(i=f.value)==null?void 0:i.height},i=>{i!=null&&r("update:height",i)}),j(()=>{var i,o;return a.renderless?T(J,null,[(i=t.default)==null?void 0:i.call(t,{itemRef:s})]):T("div",oe({ref:s,class:["v-virtual-scroll__item",a.class],style:a.style},c),[(o=t.default)==null?void 0:o.call(t)])})}}),Re=-1,xe=1,N=100,Pe=C({itemHeight:{type:[Number,String],default:null},itemKey:{type:[String,Array,Function],default:null},height:[Number,String]},"virtual");function be(a,n){const c=se(),r=I(0);W(()=>{r.value=parseFloat(a.itemHeight||0)});const t=I(0),s=I(Math.ceil((parseInt(a.height)||c.height.value)/(r.value||16))||1),f=I(0),i=I(0),o=X(),h=X();let R=0;const{resizeRef:z,contentRect:b}=Y();W(()=>{z.value=o.value});const S=E(()=>{var e;return o.value===document.documentElement?c.height.value:((e=b.value)==null?void 0:e.height)||parseInt(a.height)||0}),M=E(()=>!!(o.value&&h.value&&S.value&&r.value));let g=Array.from({length:n.value.length}),v=Array.from({length:n.value.length});const d=I(0);let p=-1;function k(e){return g[e]||r.value}const F=ue(()=>{const e=performance.now();v[0]=0;const l=n.value.length;for(let u=1;u<=l-1;u++)v[u]=(v[u-1]||0)+k(u-1);d.value=Math.max(d.value,performance.now()-e)},d),$=A(M,e=>{e&&($(),R=h.value.offsetTop,F.immediate(),w(),~p&&ie(()=>{fe&&window.requestAnimationFrame(()=>{K(p),p=-1})}))});Z(()=>{F.clear()});function ee(e,l){const u=g[e],m=r.value;r.value=m?Math.min(r.value,l):l,(u!==l||m!==r.value)&&(g[e]=l,F())}function y(e){e=H(e,0,n.value.length-1);const l=Math.floor(e),u=e%1,m=l+1,P=v[l]||0,V=v[m]||P;return P+(V-P)*u}function q(e){return ke(v,e)}let O=0,x=0,B=0;A(S,(e,l)=>{l&&(w(),e<l&&requestAnimationFrame(()=>{x=0,w()}))});let D=-1;function te(){if(!o.value||!h.value)return;const e=o.value.scrollTop,l=performance.now();l-B>500?(x=Math.sign(e-O),R=h.value.offsetTop):x=e-O,O=e,B=l,window.clearTimeout(D),D=window.setTimeout(U,500),w()}function U(){!o.value||!h.value||(x=0,B=0,window.clearTimeout(D),w())}let L=-1;function w(){cancelAnimationFrame(L),L=requestAnimationFrame(le)}function le(){if(!o.value||!S.value||!r.value)return;const e=O-R,l=Math.sign(x),u=Math.max(0,e-N),m=H(q(u),0,n.value.length),P=e+S.value+N,V=H(q(P)+1,m+1,n.value.length);if((l!==Re||m<t.value)&&(l!==xe||V>s.value)){const ne=y(t.value)-y(m),re=y(V)-y(s.value);Math.max(ne,re)>N?(t.value=m,s.value=V):(m<=0&&(t.value=m),V>=n.value.length&&(s.value=V))}f.value=y(t.value),i.value=y(n.value.length)-y(s.value)}function K(e){const l=y(e);!o.value||e&&!l?p=e:o.value.scrollTop=l}const ae=E(()=>n.value.slice(t.value,s.value).map((e,l)=>{const u=l+t.value;return{raw:e,index:u,key:ce(e,a.itemKey,u)}}));return A(n,()=>{g=Array.from({length:n.value.length}),v=Array.from({length:n.value.length}),F.immediate(),w()},{deep:1}),{calculateVisibleItems:w,containerRef:o,markerRef:h,computedItems:ae,paddingTop:f,paddingBottom:i,scrollToIndex:K,handleScroll:te,handleScrollend:U,handleItemResize:ee}}function ke(a,n){let c=a.length-1,r=0,t=0,s=null,f=-1;if(a[c]<n)return c;for(;r<=c;)if(t=r+c>>1,s=a[t],s>n)c=t-1;else if(s<n)f=t,r=t+1;else return s===n?t:r;return f}const Fe=C({items:{type:Array,default:()=>[]},renderless:Boolean,...Pe(),...Q(),...Se()},"VVirtualScroll"),Ae=G()({name:"VVirtualScroll",props:Fe(),setup(a,n){let{slots:c}=n;const r=ve("VVirtualScroll"),{dimensionStyles:t}=de(a),{calculateVisibleItems:s,containerRef:f,markerRef:i,handleScroll:o,handleScrollend:h,handleItemResize:R,scrollToIndex:z,paddingTop:b,paddingBottom:S,computedItems:M}=be(a,me(()=>a.items));return he(()=>a.renderless,()=>{function g(){var p,k;const d=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1)?"addEventListener":"removeEventListener";f.value===document.documentElement?(document[d]("scroll",o,{passive:!0}),document[d]("scrollend",h)):((p=f.value)==null||p[d]("scroll",o,{passive:!0}),(k=f.value)==null||k[d]("scrollend",h))}we(()=>{f.value=Ve(r.vnode.el,!0),g(!0)}),Z(g)}),j(()=>{const g=M.value.map(v=>ge(Ie,{key:v.key,renderless:a.renderless,"onUpdate:height":d=>R(v.index,d)},{default:d=>{var p;return(p=c.default)==null?void 0:p.call(c,{item:v.raw,index:v.index,...d})}}));return a.renderless?T(J,null,[T("div",{ref:i,class:"v-virtual-scroll__spacer",style:{paddingTop:_(b.value)}},null),g,T("div",{class:"v-virtual-scroll__spacer",style:{paddingBottom:_(S.value)}},null)]):T("div",{ref:f,class:ye(["v-virtual-scroll",a.class]),onScrollPassive:o,onScrollend:h,style:pe([t.value,a.style])},[T("div",{ref:i,class:"v-virtual-scroll__container",style:{paddingTop:_(b.value),paddingBottom:_(S.value)}},[g])])}),{calculateVisibleItems:s,scrollToIndex:z}}});export{Ae as V};
