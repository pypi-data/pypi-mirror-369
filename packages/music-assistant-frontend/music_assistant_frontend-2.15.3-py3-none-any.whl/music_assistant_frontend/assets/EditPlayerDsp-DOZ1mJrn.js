import{g as Ae,p as qe,ce as il,k as Be,n as ol,l as rl,D as De,E as z,ag as ie,ah as K,F as l,ar as Y,S as ul,M as Qe,cf as Ke,L as Ye,P as we,c9 as Xe,af as dl,s as ml,x as U,w as le,a as he,K as Je,ai as pl,i as vl,am as cl,h as fl,B as gl,z as ee,c as Q,J as yl,ap as _l,cg as hl,U as ge,al as Oe,W as $,X as y,Y as a,a0 as pe,bF as ae,as as _,ad as T,I as fe,a1 as Ee,aY as Ze,a5 as bl,bx as Vl,by as Ie,aa as O,a9 as te,ch as L,ci as F,e as kl,o as Le,ab as W,a2 as k,bn as Cl,bp as Se,cj as Sl,R as Pe,bs as Pl,ck as ne,m as Ll,b3 as $l,a6 as se,aW as He,b as Tl,at as Fl,a3 as Al,bv as Ue,Z as ze,G as ql,a$ as xe,bz as Ne,bG as Dl}from"./index-BGgfaO08.js";import{a as H}from"./VBtn-Bp792jbq.js";import{_ as el}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as wl}from"./VSlider-DyWLbf0b.js";import{V as ll}from"./VTextField-i_8qeZX7.js";import{V as tl}from"./VContainer-DLfYWZki.js";import{a as be,V as $e}from"./VSwitch-D_ArCbGM.js";import{V as al,a as Te}from"./VRow-Ba2PPdC8.js";import{V as Fe}from"./VSpacer-VZkyPce_.js";import{V as We,a as Ge}from"./VToolbar-BRuOCCCG.js";import{V as je}from"./VDialog-9Uz27rL3.js";import{V as Ol}from"./VAlert-DWZhUScf.js";import"./VCheckboxBtn-CZTCrZpU.js";/* empty css              */import"./VVirtualScroll-Cck1W7XL.js";const El=qe({dotColor:String,fillDot:Boolean,hideDot:Boolean,icon:Xe,iconColor:String,lineColor:String,...we(),...Ye(),...Ke(),...Qe()},"VTimelineDivider"),Il=Ae()({name:"VTimelineDivider",props:El(),setup(t,S){let{slots:g}=S;const{sizeClasses:h,sizeStyles:i}=il(t,"v-timeline-divider__dot"),{backgroundColorStyles:D,backgroundColorClasses:m}=Be(()=>t.dotColor),{roundedClasses:A}=ol(t,"v-timeline-divider__dot"),{elevationClasses:w}=rl(t),{backgroundColorClasses:x,backgroundColorStyles:u}=Be(()=>t.lineColor);return De(()=>z("div",{class:K(["v-timeline-divider",{"v-timeline-divider--fill-dot":t.fillDot},t.class]),style:ie(t.style)},[z("div",{class:K(["v-timeline-divider__before",x.value]),style:ie(u.value)},null),!t.hideDot&&z("div",{key:"dot",class:K(["v-timeline-divider__dot",w.value,A.value,h.value]),style:ie(i.value)},[z("div",{class:K(["v-timeline-divider__inner-dot",m.value,A.value]),style:ie(D.value)},[g.default?l(ul,{key:"icon-defaults",disabled:!t.icon,defaults:{VIcon:{color:t.iconColor,icon:t.icon,size:t.size}}},g.default):l(Y,{key:"icon",color:t.iconColor,icon:t.icon,size:t.size},null)])]),z("div",{class:K(["v-timeline-divider__after",x.value]),style:ie(u.value)},null)])),{}}}),nl=qe({density:String,dotColor:String,fillDot:Boolean,hideDot:Boolean,hideOpposite:{type:Boolean,default:void 0},icon:Xe,iconColor:String,lineInset:[Number,String],side:{type:String,validator:t=>t==null||["start","end"].includes(t)},...we(),...pl(),...Qe(),...Ye(),...Ke(),...Je()},"VTimelineItem"),me=Ae()({name:"VTimelineItem",props:nl(),setup(t,S){let{slots:g}=S;const{dimensionStyles:h}=dl(t),i=ml(0),D=U();return le(D,m=>{var A;m&&(i.value=((A=m.$el.querySelector(".v-timeline-divider__dot"))==null?void 0:A.getBoundingClientRect().width)??0)},{flush:"post"}),De(()=>{var m,A;return z("div",{class:K(["v-timeline-item",{"v-timeline-item--fill-dot":t.fillDot,"v-timeline-item--side-start":t.side==="start","v-timeline-item--side-end":t.side==="end"},t.class]),style:ie([{"--v-timeline-dot-size":he(i.value),"--v-timeline-line-inset":t.lineInset?`calc(var(--v-timeline-dot-size) / 2 + ${he(t.lineInset)})`:he(0)},t.style])},[z("div",{class:"v-timeline-item__body",style:ie(h.value)},[(m=g.default)==null?void 0:m.call(g)]),l(Il,{ref:D,hideDot:t.hideDot,icon:t.icon,iconColor:t.iconColor,size:t.size,elevation:t.elevation,dotColor:t.dotColor,fillDot:t.fillDot,rounded:t.rounded},{default:g.icon}),t.density!=="compact"&&z("div",{class:"v-timeline-item__opposite"},[!t.hideOpposite&&((A=g.opposite)==null?void 0:A.call(g))])])}),{}}}),Rl=qe({align:{type:String,default:"center",validator:t=>["center","start"].includes(t)},direction:{type:String,default:"vertical",validator:t=>["vertical","horizontal"].includes(t)},justify:{type:String,default:"auto",validator:t=>["auto","center"].includes(t)},side:{type:String,validator:t=>t==null||["start","end"].includes(t)},lineThickness:{type:[String,Number],default:2},lineColor:String,truncateLine:{type:String,validator:t=>["start","end","both"].includes(t)},...hl(nl({lineInset:0}),["dotColor","fillDot","hideOpposite","iconColor","lineInset","size"]),...we(),..._l(),...Je(),...yl()},"VTimeline"),Ml=Ae()({name:"VTimeline",props:Rl(),setup(t,S){let{slots:g}=S;const{themeClasses:h}=vl(t),{densityClasses:i}=cl(t),{rtlClasses:D}=fl();gl({VTimelineDivider:{lineColor:ee(()=>t.lineColor)},VTimelineItem:{density:ee(()=>t.density),dotColor:ee(()=>t.dotColor),fillDot:ee(()=>t.fillDot),hideOpposite:ee(()=>t.hideOpposite),iconColor:ee(()=>t.iconColor),lineColor:ee(()=>t.lineColor),lineInset:ee(()=>t.lineInset),size:ee(()=>t.size)}});const m=Q(()=>{const w=t.side?t.side:t.density!=="default"?"end":null;return w&&`v-timeline--side-${w}`}),A=Q(()=>{const w=["v-timeline--truncate-line-start","v-timeline--truncate-line-end"];switch(t.truncateLine){case"both":return w;case"start":return w[0];case"end":return w[1];default:return null}});return De(()=>l(t.tag,{class:K(["v-timeline",`v-timeline--${t.direction}`,`v-timeline--align-${t.align}`,`v-timeline--justify-${t.justify}`,A.value,{"v-timeline--inset-line":!!t.lineInset},h.value,i.value,m.value,D.value,t.class]),style:ie([{"--v-timeline-line-thickness":he(t.lineThickness)},t.style])},g)),{}}}),Bl=ge({__name:"DSPPipeline",props:{dsp:{},selected:{}},emits:["onSelect","onAddFilter","onMoveFilter","onDeleteFilter"],setup(t,{emit:S}){const g=Oe(),h=t,i=S,D=b=>h.selected===b?"primary":"secondary",m=b=>b==="input"||b==="output"?!1:!h.dsp.filters[b].enabled,A=b=>h.selected===b?"primary":g.global.current.value.dark?"grey-darken-3":"grey-lighten-3",w=b=>({"filter-selected":h.selected===b}),x=b=>{i("onSelect",b)},u=(b,I)=>{i("onMoveFilter",{index:b,direction:I})},C=b=>{i("onDeleteFilter",b)},B=function(b,I){const q=[{label:"settings.dsp.move_up",labelArgs:[],action:()=>{u(I,"up")},disabled:I===0,icon:"mdi-arrow-up"},{label:"settings.dsp.move_down",labelArgs:[],action:()=>{u(I,"down")},disabled:I===h.dsp.filters.length-1,icon:"mdi-arrow-down"},{label:"settings.dsp.delete_filter",labelArgs:[],action:()=>{C(I)},icon:"mdi-delete"}];bl.emit("contextmenu",{items:q,posX:b.clientX,posY:b.clientY})};return(b,I)=>(y(),$(Ml,{density:"compact",side:"end"},{default:a(()=>[l(me,{"dot-color":D("input"),size:"x-small",onClick:I[0]||(I[0]=q=>x("input"))},{default:a(()=>[l(H,{flat:"",rounded:"pill",color:A("input"),class:K([w("input"),"dsp-pipeline-card"])},{default:a(()=>[l(ae,{class:"px-3 py-1"},{default:a(()=>[_(T(b.$t("settings.dsp.input")),1)]),_:1})]),_:1},8,["color","class"])]),_:1},8,["dot-color"]),l(me,{"hide-dot":!0,size:"x-small"}),(y(!0),pe(fe,null,Ee(b.dsp.filters,(q,R)=>(y(),$(me,{key:R,"dot-color":D(R),size:"x-small","hide-dot":m(R),onClick:oe=>x(R),onContextmenu:Ze(oe=>B(oe,R),["prevent"])},{default:a(()=>[l(H,{flat:"",rounded:"pill",color:A(R),class:K([w(R),"dsp-pipeline-card"])},{default:a(()=>[l(ae,{class:"px-3 py-1"},{default:a(()=>[_(T(b.$t(`settings.dsp.types.${q.type}`)),1)]),_:2},1024)]),_:2},1032,["color","class"])]),_:2},1032,["dot-color","hide-dot","onClick","onContextmenu"]))),128)),l(me,{"dot-color":"secondary",size:"x-small","hide-dot":!0},{default:a(()=>[l(H,{outlined:"",rounded:"pill",class:"dsp-pipeline-card add-filter-btn",elevation:0,onClick:I[1]||(I[1]=q=>i("onAddFilter"))},{default:a(()=>[l(ae,{class:"py-1 d-flex align-center"},{default:a(()=>[l(Y,{size:"small",class:"mr-1"},{default:a(()=>I[3]||(I[3]=[_("mdi-plus",-1)])),_:1,__:[3]}),_(" "+T(b.$t("settings.dsp.filter.add")),1)]),_:1})]),_:1})]),_:1}),l(me,{"hide-dot":!0,size:"x-small"}),l(me,{"dot-color":D("output"),size:"x-small",onClick:I[2]||(I[2]=q=>x("output"))},{default:a(()=>[l(H,{flat:"",rounded:"pill",color:A("output"),class:K([w("output"),"dsp-pipeline-card"])},{default:a(()=>[l(ae,{class:"px-3 py-1"},{default:a(()=>[_(T(b.$t("settings.dsp.output")),1)]),_:1})]),_:1},8,["color","class"])]),_:1},8,["dot-color"])]),_:1}))}}),Hl=el(Bl,[["__scopeId","data-v-0e0b8e42"]]),Ul={style:{"min-width":"100px"},class:"v-label pl-2"},zl={style:{"min-width":"40px"},class:"pl-2"},J=ge({__name:"DSPSlider",props:Vl({type:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const S=t,g=Ie(t,"modelValue"),h=U(!1),i=Q(()=>S.type==="gain"?{min:-15,max:15,step:.1,label:O("settings.dsp.parameter.gain"),unit:"dB",is_log:!1}:S.type==="q"?{min:.1,max:20,step:.1,label:O("settings.dsp.parameter.q_factor"),unit:"",is_log:!1}:S.type==="frequency"?{min:20,max:2e4,step:1,label:O("settings.dsp.parameter.frequency"),unit:"Hz",is_log:!0}:S.type),D=Q({get:()=>h.value?g.value.toString():g.value>1e3?g.value.toFixed(0):g.value>100?g.value.toFixed(1):g.value.toFixed(2),set:u=>{g.value=Number(u)}}),m=Q({get:()=>i.value.is_log?Math.log10(g.value):g.value,set:u=>{i.value.is_log?g.value=Math.pow(10,u):g.value=u}}),A=Q(()=>i.value.is_log?Math.log10(i.value.max):i.value.max),w=Q(()=>i.value.is_log?Math.log10(i.value.min):i.value.min),x=Q(()=>i.value.is_log?Math.log10(i.value.step):i.value.step);return(u,C)=>(y(),$(te,{flat:"",color:"transparent"},{default:a(()=>[l(ae,{class:"d-flex align-center gap-4"},{default:a(()=>[z("span",Ul,T(i.value.label),1),l(wl,{modelValue:m.value,"onUpdate:modelValue":C[0]||(C[0]=B=>m.value=B),min:w.value,max:A.value,step:x.value,"hide-details":"",class:"flex-grow-1 pr-4",density:"compact",color:"primary"},null,8,["modelValue","min","max","step"]),l(ll,{modelValue:D.value,"onUpdate:modelValue":C[1]||(C[1]=B=>D.value=B),type:"number","hide-details":"",density:"compact",style:{"max-width":"100px"},onFocus:C[2]||(C[2]=B=>h.value=!0),onBlur:C[3]||(C[3]=B=>h.value=!1)},null,8,["modelValue"]),z("span",zl,T(i.value.unit),1)]),_:1})]),_:1}))}}),xl={class:"d-flex flex-wrap justify-end align-center ga-2 pr-2"},Nl={class:"d-flex align-center pl-1"},Wl=ge({__name:"DSPParametricEQ",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(t){const S={PK:L.PEAK,PEQ:L.PEAK,HP:L.HIGH_PASS,HPQ:L.HIGH_PASS,LP:L.LOW_PASS,LPQ:L.LOW_PASS,LS:L.LOW_SHELF,HS:L.HIGH_SHELF,NO:L.NOTCH},g={[L.PEAK]:"PK",[L.HIGH_PASS]:"HP",[L.LOW_PASS]:"LP",[L.LOW_SHELF]:"LS",[L.HIGH_SHELF]:"HS",[L.NOTCH]:"NO"},h=Object.entries(F).map(([n,e])=>({title:O(`settings.dsp.channels.${n}`),value:e})),i=n=>{const e=n.split(`
`),r=[];let P=!1,E={},V=F.ALL;for(const d of e)if(d.startsWith("Channel:")){const f=d.match(/Channel:\s*(.+)/);if(f&&f[1]){const v=f[1].trim().toUpperCase();v==="ALL"||v==="1 2"||v==="L R"?V=F.ALL:v==="L"||v==="1"||v==="FL"?(V=F.FL,P=!0):(v==="R"||v==="2"||v==="FR")&&(V=F.FR,P=!0)}E[V]||(E[V]=0)}else if(d.startsWith("Filter")){const f=d.match(/Filter(?:\s+\d+)?:\s+(ON|OFF)\s+(\w+)\s+(?:Fc\s+)?(\d+\.?\d*)\s*(?:Hz)?\s+(?:Gain\s+)?(-?\d+\.?\d*)\s+dB\s+(?:(?:Q\s+)?(\d+\.?\d*)|(?:BW\s+Oct\s+)(\d+\.?\d*))/);if(f){const[v,j,Z,Re,ke,Ce,X]=f;Z!=="None"&&r.push({frequency:parseFloat(Re),gain:parseFloat(ke),q:parseFloat(Ce),type:S[Z]||L.PEAK,enabled:j==="ON",channel:V})}}else if(d.startsWith("Preamp")){const f=d.match(/Preamp:\s*(-?\d+\.?\d*)\s+dB/);f&&(E[V]=parseFloat(f[1]))}let c;P?c=u.value.bands.filter(d=>!r.some(f=>f.channel===d.channel||f.channel===F.ALL||d.channel===F.ALL)):M.value!==F.ALL?(c=u.value.bands.filter(d=>d.channel!==F.ALL&&d.channel!==M.value),E.ALL&&(E[M.value]=E.ALL,E.ALL=0),r.forEach(d=>{d.channel=M.value})):(c=[],u.value.per_channel_preamp={}),u.value.bands=[...c,...r],Object.keys(E).length>0?(E.ALL&&(u.value.preamp=E.ALL),Object.entries(E).forEach(([d,f])=>{d!==F.ALL&&(u.value.per_channel_preamp[d]=f)})):(u.value.preamp=0,u.value.per_channel_preamp={}),Pe(()=>{G.value=-1})},D=n=>{const e=n.target;if(e.files&&e.files[0]){const r=e.files[0],P=new FileReader;P.onload=E=>{var V;(V=E.target)!=null&&V.result&&i(E.target.result)},P.readAsText(r)}},m=U(null),A=()=>{var n;(n=m.value)==null||n.click()},w=()=>{var E;let n="";if(n+=`Preamp: ${ve.value.toFixed(2)} dB
`,re.value){const V=Object.values(F);for(const c of V){if(c===F.ALL)continue;const d=((E=h.find(v=>v.value===c))==null?void 0:E.title)||c;n+=`
# ${d}
`,n+=`Channel: ${c===F.FL?"L":"R"}
`,u.value.per_channel_preamp[c]!==void 0&&(n+=`Preamp: ${u.value.per_channel_preamp[c].toFixed(2)} dB
`);let f=1;u.value.bands.forEach(v=>{if(v.channel===c||v.channel===F.ALL){const j=g[v.type];n+=`Filter ${f++}: ${v.enabled?"ON":"OFF"} ${j} Fc ${v.frequency.toFixed(1)} Hz Gain ${v.gain.toFixed(2)} dB Q ${v.q.toFixed(3)}
`}})}}else u.value.bands.forEach((V,c)=>{const d=g[V.type];n+=`Filter ${c+1}: ${V.enabled?"ON":"OFF"} ${d} Fc ${V.frequency.toFixed(1)} Hz Gain ${V.gain.toFixed(2)} dB Q ${V.q.toFixed(3)}
`});const e=new Blob([n],{type:"text/plain"}),r=URL.createObjectURL(e),P=document.createElement("a");P.href=r,P.download=`music_assistant_eq_settings_${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(P),P.click(),document.body.removeChild(P),URL.revokeObjectURL(r)},x=Oe(),u=Ie(t,"modelValue"),C=U(null),B=U(null),b=Object.values(L).map(n=>({title:O(`settings.dsp.parametric_eq.filter_types.${n}`),value:n})),I=n=>![L.HIGH_PASS,L.LOW_PASS,L.NOTCH].includes(n),q=U({width:0,height:0,min_gain:-20,max_gain:20,min_freq:20,max_freq:2e4,padding_lr:40,padding_tb:20}),R=()=>{if(!C.value||!B.value)return;const n=x.global.current.value.dark,e=C.value.getContext("2d");if(!e)return;C.value.width=B.value.clientWidth*2,C.value.height=B.value.clientHeight*2,q.value.width=C.value.width/2,q.value.height=C.value.height/2,e.scale(2,2),e.clearRect(0,0,C.value.width,C.value.height),ce(e,q.value);const r=e.canvas.width/2;e.canvas.height/2;const P=(V,c,d)=>{let f=`hsla(${c*360/u.value.bands.length}, 60%, ${n?70:50}%, 0.5)`;d.beginPath(),c===G.value?(d.lineWidth=5,f=`hsla(${c*360/u.value.bands.length}, 70%, ${n?70:60}%, 1)`):d.lineWidth=2,d.strokeStyle=f;const v=new Float32Array(r);for(let X=0;X<r;X++)v[X]=s(X,q.value);const j=new Float32Array(r),Z=new Float32Array(r);oe(ye,V).getFrequencyResponse(v,j,Z);for(let X=q.value.padding_lr;X<r-q.value.padding_lr;X++){const sl=20*Math.log10(j[X]),Me=p(sl,q.value);X===q.value.padding_lr?d.moveTo(X,Me):d.lineTo(X,Me)}d.stroke();const ke=o(V.frequency,q.value),Ce=p(V.gain,q.value);return d.beginPath(),d.fillStyle=f,d.arc(ke,Ce,6,0,2*Math.PI),d.fill(),{frequencies:v,magResponse:j}},E=(V,c)=>{c.lineWidth=3,n?c.strokeStyle="#fff":c.strokeStyle="#000",c.beginPath();for(let d=q.value.padding_lr;d<r-q.value.padding_lr;d++){const f=p(V[d],q.value);d===q.value.padding_lr?c.moveTo(d,f):c.lineTo(d,f)}c.stroke()};if(M.value===F.ALL&&re.value){const V=Object.values(F).filter(d=>d!==F.ALL),c={};V.forEach(d=>{c[d]=new Float32Array(r).fill((u.value.preamp??0)+(u.value.per_channel_preamp[d]??0))}),u.value.bands.forEach((d,f)=>{if(d.enabled){const{magResponse:v}=P(d,f,e);if(d.channel===F.ALL)V.forEach(j=>{for(let Z=0;Z<r;Z++)c[j][Z]+=20*Math.log10(v[Z])});else for(let j=0;j<r;j++)c[d.channel][j]+=20*Math.log10(v[j])}}),V.forEach(d=>{E(c[d],e)})}else{const V=new Float32Array(r).fill((u.value.preamp??0)+(u.value.per_channel_preamp[M.value]??0));u.value.bands.forEach((c,d)=>{if(c.enabled&&c.channel===M.value||c.channel===F.ALL){const{magResponse:f}=P(c,d,e);for(let v=0;v<r;v++)V[v]+=20*Math.log10(f[v])}}),E(V,e)}},oe=(n,e)=>{const r=n.createBiquadFilter();switch(e.type){case L.HIGH_PASS:r.type="highpass";break;case L.LOW_PASS:r.type="lowpass";break;case L.HIGH_SHELF:r.type="highshelf";break;case L.LOW_SHELF:r.type="lowshelf";break;case L.NOTCH:r.type="notch";break;case L.PEAK:r.type="peaking";break}return r.frequency.value=e.frequency,r.Q.value=e.q,r.gain.value=e.gain,r},ye=new AudioContext;Q(()=>u.value.bands.map(n=>oe(ye,n)));const re=Q(()=>u.value.bands.some(n=>n.channel!==F.ALL)||Object.keys(u.value.per_channel_preamp).length>0&&Object.values(u.value.per_channel_preamp).some(n=>n!==0)),ue=U(!1),G=U(-1),M=U(F.ALL),N=Q(()=>u.value.bands[G.value]),ve=Q({get:()=>u.value.preamp??0,set:n=>{u.value.preamp=n}}),_e=Q({get:()=>u.value.per_channel_preamp[M.value]??0,set:n=>{M.value!==F.ALL&&(u.value.per_channel_preamp[M.value]=n)}}),de=n=>{u.value.bands.splice(n,1),G.value>=u.value.bands.length&&Pe(()=>{G.value=u.value.bands.length-1})},Ve=()=>{const n=u.value.bands.length;u.value.bands.push({frequency:1e3,q:1,gain:0,type:L.PEAK,enabled:!0,channel:M.value}),Pe(()=>{G.value=n})};le(()=>u.value.preamp,R),le(()=>u.value.per_channel_preamp,R,{deep:!0}),le(()=>(G.value,u.value.bands),()=>{G.value>=u.value.bands.length&&(G.value=u.value.bands.length-1),R()},{deep:!0}),le(()=>M.value,R),le(()=>x.global.current.value.dark,R),kl(()=>{re.value&&(ue.value=!0)}),Le(()=>{R(),window.addEventListener("resize",R)});const o=(n,e)=>{const r=Math.log2(n/e.min_freq),P=Math.log2(e.max_freq/e.min_freq);return r/P*(e.width-e.padding_lr*2)+e.padding_lr},s=(n,e)=>{const r=Math.log2(e.max_freq/e.min_freq),P=e.min_freq*Math.pow(2,(n-e.padding_lr)/(e.width-e.padding_lr*2)*r);return Math.min(Math.max(P,e.min_freq),e.max_freq)},p=(n,e)=>e.height/2-n*(e.height-2*e.padding_tb)/(2*Math.max(Math.abs(e.min_gain),Math.abs(e.max_gain))),ce=(n,e)=>{const r=n.canvas.width/2,P=n.canvas.height/2;x.global.current.value.dark?(n.fillStyle="#eee",n.strokeStyle="#eee"):(n.fillStyle="#222",n.strokeStyle="#666"),n.lineWidth=1,[20,50,100,200,500,1e3,2e3,5e3,1e4,2e4].forEach(f=>{const v=o(f,e);n.beginPath(),n.moveTo(v,e.padding_tb),n.lineTo(v,P-e.padding_tb),n.stroke(),n.font="10px Arial",n.textAlign="center",n.fillText(f>=1e3?`${f/1e3}k`:f.toString(),v,P-5)});const c=e.max_gain-e.min_gain,d=Math.ceil(c/(e.height/30));for(let f=e.min_gain;f<=e.max_gain;f+=d){const v=p(f,e);n.beginPath(),n.moveTo(e.padding_lr,v),n.lineTo(r-e.padding_lr,v),n.stroke(),n.font="10px Arial",n.textAlign="right",n.fillText(`${f}dB`,e.padding_lr-3,v+3)}};return Le(()=>{const n=new ResizeObserver(()=>{R()});return B.value&&n.observe(B.value),()=>{n.disconnect()}}),(n,e)=>(y(),$(tl,{class:"pa-2"},{default:a(()=>[z("div",xl,[ue.value?(y(),$(be,{key:1,modelValue:M.value,"onUpdate:modelValue":e[1]||(e[1]=r=>M.value=r),class:"pa-2",items:k(h),label:k(O)("settings.dsp.parametric_eq.edited_channel"),variant:"outlined",density:"comfortable",style:{"min-width":"250px"},"hide-details":""},null,8,["modelValue","items","label"])):(y(),$(H,{key:0,variant:"outlined",onClick:e[0]||(e[0]=()=>{ue.value=!0})},{default:a(()=>[l(Y,{start:""},{default:a(()=>e[12]||(e[12]=[_("mdi-speaker-multiple",-1)])),_:1,__:[12]}),_(" "+T(k(O)("settings.dsp.parametric_eq.show_multichannel_controls")),1)]),_:1})),l(H,{variant:"outlined",onClick:A},{default:a(()=>[l(Y,{start:""},{default:a(()=>e[13]||(e[13]=[_("mdi-file-import",-1)])),_:1,__:[13]}),_(" "+T(k(O)("settings.dsp.parametric_eq.import_apo")),1)]),_:1}),l(H,{variant:"outlined",onClick:w},{default:a(()=>[l(Y,{start:""},{default:a(()=>e[14]||(e[14]=[_("mdi-file-export",-1)])),_:1,__:[14]}),_(" "+T(k(O)("settings.dsp.parametric_eq.export_apo")),1)]),_:1}),z("input",{ref_key:"fileInputRef",ref:m,type:"file",accept:".txt",class:"d-none",onChange:D},null,544)]),l(te,{elevation:"0",color:"transparent"},{default:a(()=>[z("div",{ref_key:"graphContainer",ref:B,class:"graph-container"},[z("canvas",{ref_key:"canvas",ref:C,class:"frequency-graph"},null,512)],512)]),_:1}),l(te,{elevation:"0",color:"transparent",class:"border-t border-b rounded-0"},{default:a(()=>[l(ae,{class:"pa-0"},{default:a(()=>[l(Cl,{modelValue:G.value,"onUpdate:modelValue":e[2]||(e[2]=r=>G.value=r),class:"mb-0 pa-2",mandatory:"","selected-class":"primary"},{default:a(()=>[(y(),$(Se,{key:-1,value:-1,filter:"",variant:"elevated"},{default:a(()=>[_(T(k(O)("settings.dsp.parametric_eq.preamp",{index:100})),1)]),_:1})),(y(!0),pe(fe,null,Ee(u.value.bands,(r,P)=>(y(),$(Se,{key:P,value:P,class:K({"opacity-50":!r.enabled}),filter:"",variant:"elevated"},{default:a(()=>[_(T(r.channel===k(F).ALL?k(O)("settings.dsp.parametric_eq.band",{index:P+1}):k(O)("settings.dsp.parametric_eq.band_channel",{index:P+1,channel:k(O)(`settings.dsp.channels_compact.${r.channel}`)})),1)]),_:2},1032,["value","class"]))),128)),l(Se,{variant:"outlined",onClick:Ve},{default:a(()=>[l(Y,{icon:"mdi-plus",start:""}),_(" "+T(M.value===k(F).ALL?k(O)("settings.dsp.parametric_eq.add_band"):k(O)("settings.dsp.parametric_eq.add_band_channel",{channel:k(O)(`settings.dsp.channels.${M.value}`)})),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),G.value===-1?(y(),$(te,{key:0,elevation:"0",color:"transparent"},{default:a(()=>[l(ae,null,{default:a(()=>[l(al,{dense:""},{default:a(()=>[l(Te,{cols:"12"},{default:a(()=>[l(J,{modelValue:ve.value,"onUpdate:modelValue":e[3]||(e[3]=r=>ve.value=r),type:"gain"},null,8,["modelValue"]),M.value!==k(F).ALL?(y(),$(J,{key:0,modelValue:_e.value,"onUpdate:modelValue":e[4]||(e[4]=r=>_e.value=r),type:{min:-15,max:15,step:.1,label:k(O)("settings.dsp.parametric_eq.per_channel_preamp",{channel:k(O)(`settings.dsp.channels.${M.value}`)}),unit:"dB",is_log:!1}},null,8,["modelValue","type"])):W("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):W("",!0),N.value?(y(),pe(fe,{key:1},[l(Sl,null,{default:a(()=>[z("div",Nl,[l($e,{modelValue:N.value.enabled,"onUpdate:modelValue":e[5]||(e[5]=r=>N.value.enabled=r),label:k(O)("settings.dsp.parametric_eq.enable_band"),density:"comfortable","hide-details":"",color:"primary"},null,8,["modelValue","label"]),l(Fe),l(H,{color:"error",variant:"tonal",onClick:e[6]||(e[6]=r=>de(G.value))},{default:a(()=>[l(Y,null,{default:a(()=>e[15]||(e[15]=[_("mdi-delete",-1)])),_:1,__:[15]}),_(" "+T(k(O)("settings.dsp.parametric_eq.delete_band")),1)]),_:1})])]),_:1}),l(be,{modelValue:N.value.type,"onUpdate:modelValue":e[7]||(e[7]=r=>N.value.type=r),items:k(b),label:k(O)("settings.dsp.parametric_eq.filter_type"),variant:"outlined",density:"comfortable",class:"pa-4","hide-details":""},null,8,["modelValue","items","label"]),l(J,{modelValue:N.value.frequency,"onUpdate:modelValue":e[8]||(e[8]=r=>N.value.frequency=r),type:"frequency"},null,8,["modelValue"]),I(N.value.type)?(y(),$(J,{key:0,modelValue:N.value.gain,"onUpdate:modelValue":e[9]||(e[9]=r=>N.value.gain=r),type:"gain"},null,8,["modelValue"])):W("",!0),l(J,{modelValue:N.value.q,"onUpdate:modelValue":e[10]||(e[10]=r=>N.value.q=r),type:"q"},null,8,["modelValue"]),ue.value?(y(),$(be,{key:1,modelValue:N.value.channel,"onUpdate:modelValue":e[11]||(e[11]=r=>N.value.channel=r),items:k(h),label:k(O)("settings.dsp.parametric_eq.channel"),variant:"outlined",density:"comfortable",class:"pa-4","hide-details":""},null,8,["modelValue","items","label"])):W("",!0)],64)):W("",!0)]),_:1}))}}),Gl=el(Wl,[["__scopeId","data-v-ac29d681"]]),jl=ge({__name:"DSPToneControl",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(t){const S=Ie(t,"modelValue");return(g,h)=>(y(),pe(fe,null,[l(J,{modelValue:S.value.bass_level,"onUpdate:modelValue":h[0]||(h[0]=i=>S.value.bass_level=i),type:{min:-10,max:10,step:.1,label:g.$t("settings.dsp.tone_control.bass_level"),unit:"dB",is_log:!1}},null,8,["modelValue","type"]),l(J,{modelValue:S.value.mid_level,"onUpdate:modelValue":h[1]||(h[1]=i=>S.value.mid_level=i),type:{min:-10,max:10,step:.1,label:g.$t("settings.dsp.tone_control.mid_level"),unit:"dB",is_log:!1}},null,8,["modelValue","type"]),l(J,{modelValue:S.value.treble_level,"onUpdate:modelValue":h[2]||(h[2]=i=>S.value.treble_level=i),type:{min:-10,max:10,step:.1,label:g.$t("settings.dsp.tone_control.treble_level"),unit:"dB",is_log:!1}},null,8,["modelValue","type"])],64))}}),Ql={key:0},Kl={class:"d-none d-md-inline"},Yl={class:"d-none d-md-inline"},pt=ge({__name:"EditPlayerDsp",props:{playerId:{}},setup(t){const{t:S}=Pl();Dl();const g=Oe(),h=t,i=U(),D=U([]),m=U(null),A=U(!1),w=U(!1),x=U(ne.PARAMETRIC_EQ),u=U("");U(window.innerWidth);const{mobile:C}=Ll();let B=!1,b;const I=Object.values(ne).map(o=>({value:o,title:S(`settings.dsp.types.${o}`)})),q=()=>g.global.current.value.dark?"bg-grey-darken-3":"bg-grey-lighten-3",R=o=>{m.value=o},oe=o=>{var s;return S(o==="input"?"settings.dsp.input":o==="output"?"settings.dsp.output":`settings.dsp.types.${(s=i.value)==null?void 0:s.filters[o].type}`)},ye=()=>{if(!i.value)return;let o;switch(x.value){case ne.PARAMETRIC_EQ:o={preamp:0,per_channel_preamp:{},enabled:!0,type:ne.PARAMETRIC_EQ,bands:[]};break;case ne.TONE_CONTROL:o={enabled:!0,type:ne.TONE_CONTROL,bass_level:0,mid_level:0,treble_level:0};break;default:return}i.value.filters.push(o),A.value=!1,R(i.value.filters.length-1)},re=(o,s)=>{if(!i.value)return;const p=s==="up"?o-1:o+1;if(p<0||p>=i.value.filters.length)return;const[ce]=i.value.filters.splice(o,1);i.value.filters.splice(p,0,ce),m.value===o?m.value=p:m.value===p&&(m.value=o)},ue=o=>{var s;m.value===o&&(m.value="input"),(s=i.value)==null||s.filters.splice(o,1)},G=async o=>{!o||!o.config||(m.value="input",i.value=o.config)},M=async()=>{if(!i.value||!u.value.trim())return;const o={name:u.value.trim(),config:i.value};try{await se.saveDSPPreset(o),u.value="",w.value=!1}catch(s){console.error("Failed to save DSP preset:",s)}},N=async o=>{!o||!confirm(S("settings.dsp.presets.remove_confirm"))||(await se.removeDSPPreset(o),D.value=D.value.filter(s=>s.preset_id!==o))};le(C,o=>{!o&&m.value===null&&R("input")},{immediate:!0});const ve=Q(()=>$l(se.players[h.playerId],27));le(()=>h.playerId,async o=>{b&&b(),B=!0,o&&(i.value=await se.getDSPConfig(o)),b=se.subscribe(He.PLAYER_DSP_CONFIG_UPDATED,s=>{B=!0,i.value=s.data},h.playerId)},{immediate:!0});const _e=se.subscribe(He.DSP_PRESETS_UPDATED,o=>{D.value=o.data});Le(async()=>{D.value=await se.getDSPPresets()}),Tl(()=>{b&&b(),_e()});let de=null;const Ve=o=>{de&&clearTimeout(de),de=setTimeout(async()=>{h.playerId&&await se.saveDSPConfig(h.playerId,o)},2e3)};return le(i,(o,s)=>{if(B){de&&clearTimeout(de),B=!1;return}s!==null&&o&&Ve(o)},{deep:!0}),(o,s)=>i.value?(y(),pe("section",Ql,[l(We,{color:"transparent",class:"border-b pr-4"},{default:a(()=>[l($e,{modelValue:i.value.enabled,"onUpdate:modelValue":s[0]||(s[0]=p=>i.value.enabled=p),"hide-details":"",color:"primary",class:"pl-4"},null,8,["modelValue"]),l(Ge,null,{default:a(()=>[_(T(o.$t("settings.dsp.configure_on",{name:ve.value})),1)]),_:1}),l(Fl,{"offset-y":"",transition:"slide-y-transition"},{activator:a(({props:p})=>[l(H,ql(p,{class:["mr-4",q()]}),{default:a(()=>[l(Y,{class:"p-0 ms-md-n1 me-md-2"},{default:a(()=>s[19]||(s[19]=[_(" mdi-tray-arrow-down ",-1)])),_:1,__:[19]}),z("span",Kl,T(o.$t("settings.dsp.presets.load")),1)]),_:2},1040,["class"])]),default:a(()=>[l(Al,null,{default:a(()=>[D.value.length===0?(y(),$(ze,{key:0},{default:a(()=>[l(Ue,null,{default:a(()=>[_(T(o.$t("settings.dsp.presets.empty_warning")),1)]),_:1})]),_:1})):(y(!0),pe(fe,{key:1},Ee(D.value,p=>(y(),$(ze,{key:p.preset_id,onClick:ce=>G(p)},{append:a(()=>[l(H,{icon:"mdi-delete",variant:"text",density:"compact",onClick:Ze(ce=>N(p.preset_id),["stop"])},null,8,["onClick"])]),default:a(()=>[l(Ue,null,{default:a(()=>[_(T(p.name),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),l(H,{class:K(q()),onClick:s[1]||(s[1]=p=>w.value=!0)},{default:a(()=>[l(Y,{class:"p-0 ms-md-n1 me-md-2"},{default:a(()=>s[20]||(s[20]=[_(" mdi-content-save ",-1)])),_:1,__:[20]}),z("span",Yl,T(o.$t("settings.dsp.presets.save")),1)]),_:1},8,["class"])]),_:1}),l(tl,{class:"pa-4"},{default:a(()=>[i.value.enabled?W("",!0):(y(),$(Ol,{key:0,type:"info",class:"mt-4",color:"transparent"},{default:a(()=>[_(T(o.$t("settings.dsp.disabled_message")),1)]),_:1})),l(al,{class:K([{"justify-center":k(C)},"flex-nowrap"])},{default:a(()=>[!k(C)||m.value===null?(y(),$(Te,{key:0,class:K(["flex-grow-0 flex-shrink-0",{"border-e pr-4":!k(C)}]),"align-self":"start"},{default:a(()=>[l(Hl,{dsp:i.value,selected:m.value,onOnSelect:R,onOnAddFilter:s[2]||(s[2]=p=>A.value=!0),onOnMoveFilter:s[3]||(s[3]=p=>re(p.index,p.direction)),onOnDeleteFilter:ue},null,8,["dsp","selected"])]),_:1},8,["class"])):W("",!0),m.value!=null?(y(),$(Te,{key:1,style:{"min-width":"0"}},{default:a(()=>[l(We,{density:"compact",color:o.$vuetify.theme.current.dark?"surface":"surface-light",class:"border-b"},{default:a(()=>[k(C)?(y(),$(H,{key:0,class:"hidden-xs-only",icon:"",onClick:s[4]||(s[4]=p=>m.value=null)},{default:a(()=>[l(Y,null,{default:a(()=>s[21]||(s[21]=[_("mdi-arrow-left",-1)])),_:1,__:[21]})]),_:1})):W("",!0),l(Ge,null,{default:a(()=>[_(T(oe(m.value)),1)]),_:1}),typeof m.value=="number"&&!k(C)&&m.value>0?(y(),$(H,{key:1,icon:"",onClick:s[5]||(s[5]=p=>re(m.value,"up"))},{default:a(()=>[l(Y,null,{default:a(()=>s[22]||(s[22]=[_("mdi-arrow-up",-1)])),_:1,__:[22]})]),_:1})):W("",!0),typeof m.value=="number"&&!k(C)&&m.value<i.value.filters.length-1?(y(),$(H,{key:2,icon:"",onClick:s[6]||(s[6]=p=>re(m.value,"down"))},{default:a(()=>[l(Y,null,{default:a(()=>s[23]||(s[23]=[_("mdi-arrow-down",-1)])),_:1,__:[23]})]),_:1})):W("",!0),typeof m.value=="number"?(y(),$($e,{key:3,modelValue:i.value.filters[m.value].enabled,"onUpdate:modelValue":s[7]||(s[7]=p=>i.value.filters[m.value].enabled=p),"hide-details":"",color:"primary",class:"mr-4"},null,8,["modelValue"])):W("",!0),typeof m.value=="number"?(y(),$(H,{key:4,icon:"",onClick:s[8]||(s[8]=p=>ue(m.value))},{default:a(()=>[l(Y,null,{default:a(()=>s[24]||(s[24]=[_("mdi-delete",-1)])),_:1,__:[24]})]),_:1})):W("",!0)]),_:1},8,["color"]),m.value==="input"?(y(),$(te,{key:0,flat:"",color:o.$vuetify.theme.current.dark?"surface":"surface-light"},{default:a(()=>[l(J,{modelValue:i.value.input_gain,"onUpdate:modelValue":s[9]||(s[9]=p=>i.value.input_gain=p),type:"gain"},null,8,["modelValue"])]),_:1},8,["color"])):m.value==="output"?(y(),$(te,{key:1,flat:"",color:o.$vuetify.theme.current.dark?"surface":"surface-light"},{default:a(()=>[l(J,{modelValue:i.value.output_gain,"onUpdate:modelValue":s[10]||(s[10]=p=>i.value.output_gain=p),type:"gain"},null,8,["modelValue"])]),_:1},8,["color"])):(y(),$(te,{key:2,flat:"",color:o.$vuetify.theme.current.dark?"surface":"surface-light"},{default:a(()=>[i.value.filters[m.value].type===k(ne).PARAMETRIC_EQ?(y(),$(Gl,{key:0,modelValue:i.value.filters[m.value],"onUpdate:modelValue":s[11]||(s[11]=p=>i.value.filters[m.value]=p)},null,8,["modelValue"])):W("",!0),i.value.filters[m.value].type===k(ne).TONE_CONTROL?(y(),$(jl,{key:1,modelValue:i.value.filters[m.value],"onUpdate:modelValue":s[12]||(s[12]=p=>i.value.filters[m.value]=p)},null,8,["modelValue"])):W("",!0)]),_:1},8,["color"]))]),_:1})):W("",!0)]),_:1},8,["class"])]),_:1}),l(je,{modelValue:w.value,"onUpdate:modelValue":s[15]||(s[15]=p=>w.value=p),"max-width":"300"},{default:a(()=>[l(te,null,{default:a(()=>[l(xe,null,{default:a(()=>[_(T(o.$t("settings.dsp.presets.save")),1)]),_:1}),l(ae,null,{default:a(()=>[l(ll,{modelValue:u.value,"onUpdate:modelValue":s[13]||(s[13]=p=>u.value=p),label:o.$t("settings.dsp.presets.name"),placeholder:o.$t("settings.dsp.presets.name_placeholder"),variant:"outlined"},null,8,["modelValue","label","placeholder"])]),_:1}),l(Ne,null,{default:a(()=>[l(Fe),l(H,{onClick:s[14]||(s[14]=p=>w.value=!1)},{default:a(()=>[_(T(o.$t("cancel")),1)]),_:1}),l(H,{color:"primary",disabled:!u.value.trim(),onClick:M},{default:a(()=>[_(T(o.$t("settings.dsp.presets.save")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(je,{modelValue:A.value,"onUpdate:modelValue":s[18]||(s[18]=p=>A.value=p),"max-width":"300"},{default:a(()=>[l(te,null,{default:a(()=>[l(xe,null,{default:a(()=>[_(T(o.$t("settings.dsp.filter.add")),1)]),_:1}),l(ae,null,{default:a(()=>[l(be,{modelValue:x.value,"onUpdate:modelValue":s[16]||(s[16]=p=>x.value=p),items:k(I),label:o.$t("settings.dsp.filter.type")},null,8,["modelValue","items","label"])]),_:1}),l(Ne,null,{default:a(()=>[l(Fe),l(H,{onClick:s[17]||(s[17]=p=>A.value=!1)},{default:a(()=>[_(T(o.$t("cancel")),1)]),_:1}),l(H,{color:"primary",onClick:ye},{default:a(()=>[_(T(o.$t("settings.dsp.filter.add")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])):W("",!0)}});export{pt as default};
