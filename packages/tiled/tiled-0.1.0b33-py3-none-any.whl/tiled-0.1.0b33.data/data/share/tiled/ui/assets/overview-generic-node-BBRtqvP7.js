import{_ as F,j as t,b as T,c as O,r as C,M as U,F as v,K as M,w as K}from"./index-GGM5jtZa.js";import{B as W,s as $}from"./browse-CFaPxdVk.js";import{f as P,u as D,s as H,c as V,g as Z,T as q,v as G,a as w,b as k,d as J,e as B,h as N,G as R,i as Q,j as X,k as Y,l as ee,m as te,D as se}from"./DataGrid-BZEU-LW-.js";import"./toPropertyKey-DCwh5dYN.js";import"./FormControlLabel-C32vo_id.js";import"./Input-DOvrdCHp.js";import"./Stack-DZDo8kHQ.js";import"./Tooltip-CjIcNsTZ.js";import"./Checkbox-7foy7vnf.js";const oe=["className","children"],ne=o=>{const{classes:f}=o;return V({root:["toolbarContainer"]},Z,f)},ae=H(q,{name:"MuiDataGrid",slot:"ToolbarContainer",shouldForwardProp:o=>o!=="ownerState"})({display:"flex",alignItems:"center",flexWrap:"wrap",gap:G.spacing(1),padding:G.spacing(.5),minHeight:"auto"}),le=P(function(f,x){const{className:c,children:e}=f,d=F(f,oe),n=D(),s=ne(n);return e?t.jsx(ae,T({className:O(s.root,c),ownerState:n},d,{ref:x,children:e})):null}),re=P(function(f,x){var a,h;const{slotProps:c={}}=f,e=c.button||{},d=c.tooltip||{},n=w(),s=w(),u=k(),b=D(),{columnsPanelTriggerRef:l}=J(),r=B(u,Q),i=N(x,l),g=m=>{var j;r.open&&r.openedPanelValue===R.columns?u.current.hidePreferences():u.current.showPreferences(R.columns,s,n),(j=e.onClick)==null||j.call(e,m)};if(b.disableColumnSelector)return null;const y=r.open&&r.panelId===s;return t.jsx(b.slots.baseTooltip,T({title:u.current.getLocaleText("toolbarColumnsLabel"),enterDelay:1e3},(a=b.slotProps)==null?void 0:a.baseTooltip,d,{children:t.jsx(b.slots.baseButton,T({id:n,size:"small","aria-label":u.current.getLocaleText("toolbarColumnsLabel"),"aria-haspopup":"menu","aria-expanded":y,"aria-controls":y?s:void 0,startIcon:t.jsx(b.slots.columnSelectorIcon,{})},(h=b.slotProps)==null?void 0:h.baseButton,e,{onPointerUp:m=>{var j;r.open&&m.stopPropagation(),(j=e.onPointerUp)==null||j.call(e,m)},onClick:g,ref:i,children:u.current.getLocaleText("toolbarColumns")}))}))}),ie=P(function(f,x){var I,L;const{slotProps:c={}}=f,e=c.button||{},d=c.tooltip||{},n=k(),s=D(),u=B(n,te),b=w(),l=w(),[r,i]=C.useState(!1),g=C.useRef(null),y=N(x,g),a=[{icon:t.jsx(s.slots.densityCompactIcon,{}),label:n.current.getLocaleText("toolbarDensityCompact"),value:"compact"},{icon:t.jsx(s.slots.densityStandardIcon,{}),label:n.current.getLocaleText("toolbarDensityStandard"),value:"standard"},{icon:t.jsx(s.slots.densityComfortableIcon,{}),label:n.current.getLocaleText("toolbarDensityComfortable"),value:"comfortable"}],h=C.useMemo(()=>{switch(u){case"compact":return t.jsx(s.slots.densityCompactIcon,{});case"comfortable":return t.jsx(s.slots.densityComfortableIcon,{});default:return t.jsx(s.slots.densityStandardIcon,{})}},[u,s]),m=p=>{var S;i(E=>!E),(S=e.onClick)==null||S.call(e,p)},j=()=>{i(!1)},_=p=>{n.current.setDensity(p),i(!1)},z=p=>{p.key==="Tab"&&p.preventDefault(),ee(p.key)&&i(!1)};if(s.disableDensitySelector)return null;const A=a.map((p,S)=>t.jsx(s.slots.baseMenuItem,{onClick:()=>_(p.value),selected:p.value===u,iconStart:p.icon,children:p.label},S));return t.jsxs(C.Fragment,{children:[t.jsx(s.slots.baseTooltip,T({title:n.current.getLocaleText("toolbarDensityLabel"),enterDelay:1e3},(I=s.slotProps)==null?void 0:I.baseTooltip,d,{children:t.jsx(s.slots.baseButton,T({size:"small",startIcon:h,"aria-label":n.current.getLocaleText("toolbarDensityLabel"),"aria-haspopup":"menu","aria-expanded":r,"aria-controls":r?l:void 0,id:b},(L=s.slotProps)==null?void 0:L.baseButton,e,{onClick:m,ref:y,children:n.current.getLocaleText("toolbarDensity")}))})),t.jsx(X,{open:r,target:g.current,onClose:j,position:"bottom-end",children:t.jsx(s.slots.baseMenuList,{id:l,className:Y.menuList,"aria-labelledby":b,onKeyDown:z,autoFocusItem:r,children:A})})]})});function ce(){return t.jsxs(le,{children:[t.jsx(re,{}),t.jsx(ie,{})]})}const de=10,ue=o=>{let f=U();const x=[{field:"id",headerName:"ID",flex:1,hide:!o.defaultColumns.includes("id")}];o.columns.map(l=>x.push({field:l.field,headerName:l.header,flex:1,hide:!o.defaultColumns.includes(l.field)}));const c=C.useContext(v),[e,d]=C.useState({page:0,pageSize:de,rows:[],loading:!1}),[n,s]=C.useState({}),[u,b]=C.useState(0);return C.useEffect(()=>{let l=!0;async function r(){let i,g;const y=new AbortController;o.columns.length===0?(g=[],i=null):(g=["metadata"],i="{"+o.columns.map(m=>`${m.field}:${m.select_metadata}`).join(",")+"}");const a=await $(c.api_url,o.segments,y.signal,g,i,e.pageSize*e.page,e.pageSize);return b(a.meta.count),a.data}return(async()=>{d(a=>({...a,loading:!0}));const i=await r(),g={};i.map(a=>(g[a.id]=a.attributes.ancestors,null));const y=i.map(a=>{const h={};return h.id=a.id,o.columns.map(m=>(h[m.field]=a.attributes.metadata[m.field],null)),h});l&&(s(g),d(a=>({...a,loading:!1,rows:y})))})(),()=>{l=!1}},[e.page,e.pageSize,o.columns,o.segments]),t.jsx(W,{sx:{my:4},children:t.jsx(M,{maxWidth:"lg",children:t.jsx(se,{columns:x,pagination:!0,rowCount:u,...e,paginationMode:"server",pageSizeOptions:[10,30,100],onPaginationModelChange:({page:l,pageSize:r})=>{d(i=>({...i,page:l,pageSize:r}))},onRowClick:l=>{f(`/browse${n[l.id].map(function(r){return"/"+r}).join("")}/${l.id}`)},slots:{toolbar:ce},disableColumnFilter:!0,autoHeight:!0})})})},je=o=>{const c=(C.useContext(v).specs||[]).find(n=>o.item.data.attributes.specs.includes(n.spec));let e,d;return c===void 0?(e=[],d=["id"]):(e=c.columns,d=c.default_columns),t.jsxs(M,{maxWidth:"lg",children:[t.jsx(K,{id:"table-title",variant:"h6",component:"h2",children:"Contents"}),t.jsx(ue,{segments:o.segments,specs:o.item.data.attributes.specs,columns:e,defaultColumns:d})]})};export{je as default};
