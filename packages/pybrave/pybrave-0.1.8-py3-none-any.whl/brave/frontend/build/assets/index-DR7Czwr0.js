import{r as o,Q as A,U as B,w as S,F as b,j as e,M as N,z as w,I as H,B as h,P,a as v,y as E,L as F,s as M,C as V,K as k,E as I}from"./index-7AvwSwCy.js";import{C as O,M as L}from"./index-CS88LIE_.js";import{c as T}from"./utils-D2B0dIuM.js";import{b as $,p as R}from"./index-QPqVsVq-.js";import{D}from"./index-D56bD6gD.js";import{S as U,P as G}from"./index-CsxUT7Dl.js";import{T as W}from"./index-CXNer6h3.js";import"./index-DRXOc65y.js";import"./Table-BNMDHWhP.js";import"./addEventListener-DsndksVL.js";var q={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908 640H804V488c0-4.4-3.6-8-8-8H548v-96h108c8.8 0 16-7.2 16-16V80c0-8.8-7.2-16-16-16H368c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h108v96H228c-4.4 0-8 3.6-8 8v152H116c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h288c8.8 0 16-7.2 16-16V656c0-8.8-7.2-16-16-16H292v-88h440v88H620c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h288c8.8 0 16-7.2 16-16V656c0-8.8-7.2-16-16-16zm-564 76v168H176V716h168zm84-408V140h168v168H428zm420 576H680V716h168v168z"}}]},name:"apartment",theme:"outlined"},K=function(i,m){return o.createElement(A,B({},i,{ref:m,icon:q}))},Q=o.forwardRef(K);const J=({pageApi:c,params:i,map:m,initialPageSize:d=12})=>{const[p,u]=o.useState([]),[r,g]=o.useState(1),[t,l]=o.useState(0),[C,x]=o.useState(!1),[n]=o.useState(d),s=async j=>{x(!0);try{const a=await c({...i,page_number:j,page_size:n}),{items:_,total:f,...z}=a.data;m&&(a.data=_.map(m)),u(a.data),l(f)}catch(a){console.error("Error fetching data:",a)}finally{x(!1)}},y=()=>{s(r)};return o.useEffect(()=>{s(r)},[r]),{data:p,pageNumber:r,totalPage:t,loading:C,setPageNumber:g,pageSize:n,reload:y}},X=({visible:c,onClose:i,params:m})=>{if(!c)return null;const[d,p]=o.useState([]),u=async()=>{const s=(await v.get("/list-namespace")).data;p(s)},{messageApi:r}=S(),[g,t]=o.useState(),[l]=b.useForm(),C=async()=>{const n=await l.validateFields();g?await v.post("/save-or-update-namespace",{...n,namespace_id:g.namespace_id}):await v.post("/save-or-update-namespace",{...n}),u()},x=async n=>{try{await v.delete(`/delete-namespace-by-id/${n}`),u(),r.success("删除成功")}catch(s){r.error(s.response.data.message)}};return o.useEffect(()=>{u()},[]),e.jsxs(N,{title:"安装namespace",open:c,onCancel:i,children:[e.jsx(w,{children:e.jsxs(b,{form:l,onFinish:C,children:[e.jsx(b.Item,{name:"name",label:"名称",rules:[{required:!0,message:"名称不能为空"}],children:e.jsx(H,{})}),e.jsx(b.Item,{children:e.jsx(h,{type:"primary",htmlType:"submit",children:"Submit"})})]})}),d&&d.map(n=>e.jsxs("div",{style:{display:"flex",marginBottom:"0.5rem",justifyContent:"space-between"},children:[e.jsxs("div",{children:[n.name,"(",n.namespace_id,")"]}),e.jsx(h,{type:"primary",size:"small",onClick:()=>{t(n),l.setFieldsValue({name:n.name})},children:"更新"}),e.jsx(P,{title:"确定删除吗？",onConfirm:()=>{x(n.namespace_id)},children:e.jsx(h,{danger:!0,size:"small",children:"删除"})})]},n.namespace_id))]})},Y=({visible:c,onClose:i,params:m})=>{if(!c)return null;const{messageApi:d}=S(),[p,u]=o.useState([]),r=async()=>{const l=(await v.get("/list-namespace-file")).data;u(l)};o.useEffect(()=>{r()},[]);const g=async t=>{try{await v.post(`/import-namespace-component?namespace=${t}`),r(),d.success("安装成功")}catch(l){d.error(l.response.data.message)}};return e.jsx(N,{footer:null,title:"安装namespace",open:c,onCancel:i,children:p&&p.map(t=>e.jsxs(w,{style:{display:"flex",marginBottom:"0.5rem",justifyContent:"space-between"},children:[e.jsxs("div",{children:[t.name,"(",t.namespace_id,")"]}),e.jsx(P,{title:"确定安装吗？",onConfirm:()=>{g(t.namespace_id)},children:e.jsx(h,{size:"small",children:"安装"})})]},t.namespace_id))})},ie=({params:c,map:i})=>{const{component_type:m}=c,d=a=>(i&&(a=i(a)),{id:a.id,component_id:a.component_id,name:a.name,category:a.category,img:a.img,tags:a.tags,order:a.order_index,path:`/component/${m}/${a.component_id}`,namespace:a.namespace,namespace_name:a.namespace_name}),{data:p,pageNumber:u,totalPage:r,loading:g,reload:t,pageSize:l,setPageNumber:C}=J({pageApi:R,params:c||{},map:d}),x=E(),{messageApi:n}=S(),{modal:s,openModal:y,closeModal:j}=F();return e.jsxs("div",{style:{maxWidth:"1500px",margin:"1rem auto"},children:[e.jsxs(w,{justify:"flex-end",gap:"small",children:[e.jsx(h,{size:"small",color:"cyan",variant:"solid",onClick:()=>{y("modalA",{data:void 0,structure:{component_type:m}})},children:"创建组件"}),e.jsx(h,{size:"small",color:"cyan",variant:"solid",onClick:()=>{y("modalB")},children:"创建/更新namespace"}),e.jsx(h,{size:"small",color:"cyan",variant:"solid",onClick:()=>{y("modalC")},children:"安装namespace"}),e.jsx(h,{size:"small",color:"primary",variant:"solid",onClick:t,children:"刷新"})]}),e.jsx("div",{style:{marginBottom:"2rem"}}),e.jsx(U,{spinning:g,children:Array.isArray(p)&&p.length!=0?e.jsx(M,{gutter:16,style:{position:"relative"},children:p.map((a,_)=>e.jsx(V,{lg:4,sm:6,xs:24,style:{marginBottom:"1rem",cursor:"pointer"},children:e.jsxs(O,{hoverable:!0,style:{height:"100%"},cover:e.jsx("img",{alt:a.label,src:a.img}),onClick:()=>x(`${a.path}`),children:[e.jsx(L,{title:e.jsxs(e.Fragment,{children:[a.name,e.jsx(k,{title:a==null?void 0:a.namespace,children:e.jsxs("span",{style:{margin:"0",color:"rgba(0, 0, 0, 0.45)",fontSize:"0.5rem"},children:[" ",a==null?void 0:a.namespace_name]})})]}),description:a==null?void 0:a.description,style:{marginBottom:"1rem"}}),a.tags&&Array.isArray(a.tags)&&a.tags.map((f,z)=>e.jsx(k,{title:f,children:e.jsx(W,{style:{wordBreak:"break-word",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:100,display:"inline-block",cursor:"default"},color:T[z],children:f})},z)),e.jsx("div",{onClick:f=>{f.stopPropagation(),y("modalG",a)},style:{position:"absolute",right:10,bottom:10,fontSize:15,color:"rgba(0,0,0,0.45)",cursor:"pointer"},children:e.jsx(Q,{})})]})},_))}):e.jsx(I,{})}),r!=0&&e.jsxs(w,{style:{marginTop:"1rem"},align:"center",children:["一共",r,"条数据  ",e.jsx(G,{current:u,pageSize:l,total:r,onChange:a=>C(a),showSizeChanger:!1})]}),e.jsx($,{callback:t,visible:s.key=="modalA"&&s.visible,onClose:j,params:s.params}),e.jsx(X,{visible:s.key=="modalB"&&s.visible,onClose:j,params:s.params}),e.jsx(Y,{visible:s.key=="modalC"&&s.visible,onClose:j,params:s.params}),e.jsx(D,{visible:s.key=="modalG"&&s.visible,onClose:j,callback:t,params:s.params})]})};export{ie as default};
