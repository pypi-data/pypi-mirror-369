"""初始化数据表

Revision ID: 9c1bf0cf8128
Revises: 
Create Date: 2025-06-17 14:17:56.200272

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import mysql

# revision identifiers, used by Alembic.
revision: str = '9c1bf0cf8128'
down_revision: Union[str, None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('api_key',
    sa.Column('id', sa.String(length=50), nullable=False, comment='随机生成唯一id'),
    sa.Column('aid', sa.Integer(), autoincrement=True, nullable=False, comment='有序自增id，可用于游标分页'),
    sa.Column('code', sa.String(length=255), nullable=False, comment='密钥字符串'),
    sa.Column('company', sa.String(length=100), nullable=False, comment='授权公司名称'),
    sa.Column('department', sa.String(length=100), nullable=True, comment='授权部门名称'),
    sa.Column('group', sa.String(length=100), nullable=True, comment='授权业务组名称'),
    sa.Column('business', sa.String(length=100), nullable=False, comment='授权业务应用名称'),
    sa.Column('expires_at', sa.DateTime(), nullable=False, comment='过期时间'),
    sa.Column('status', sa.Integer(), nullable=False, comment='API 密钥状态，0:启用，1:禁用'),
    sa.Column('ip_whitelist', sa.Text(), nullable=True, comment='IP白名单'),
    sa.Column('remark', sa.String(length=500), nullable=True, comment='备注'),
    sa.Column('created', sa.DateTime(), nullable=False, comment='创建时间'),
    sa.Column('updated', sa.DateTime(), nullable=False, comment='更新时间'),
    sa.Column('is_deleted', sa.Integer(), nullable=False, comment='删除标示，0:未删除，1:已删除'),
    sa.PrimaryKeyConstraint('aid')
    )
    op.create_index(op.f('ix_api_key_id'), 'api_key', ['id'], unique=True)
    op.create_table('app',
    sa.Column('id', sa.String(length=50), nullable=False, comment='随机生成唯一id'),
    sa.Column('aid', sa.Integer(), autoincrement=True, nullable=False, comment='有序自增id，可用于游标分页'),
    sa.Column('app_name', sa.String(length=255), nullable=False, comment='应用名称'),
    sa.Column('app_url', sa.String(length=255), nullable=False, comment='应用站点地址'),
    sa.Column('company', sa.String(length=100), nullable=False, comment='所属公司'),
    sa.Column('department', sa.String(length=100), nullable=False, comment='所属部门'),
    sa.Column('status', sa.Integer(), nullable=False, comment='应用状态，0:运行中，1:维护中，2:已停止'),
    sa.Column('remark', sa.String(length=500), nullable=True, comment='备注'),
    sa.Column('created', sa.DateTime(), nullable=False, comment='创建时间'),
    sa.Column('updated', sa.DateTime(), nullable=False, comment='更新时间'),
    sa.Column('is_deleted', sa.Integer(), nullable=False, comment='删除标示，0:未删除，1:已删除'),
    sa.PrimaryKeyConstraint('aid')
    )
    op.create_index(op.f('ix_app_id'), 'app', ['id'], unique=True)
    op.create_table('interface_log',
    sa.Column('id', sa.String(length=50), nullable=False, comment='随机生成唯一id'),
    sa.Column('aid', sa.Integer(), autoincrement=True, nullable=False, comment='有序自增id，可用于游标分页'),
    sa.Column('user_id', sa.String(length=50), nullable=False, comment='用户ID'),
    sa.Column('request_id', sa.String(length=255), nullable=False, comment='请求ID'),
    sa.Column('code', sa.String(length=500), nullable=False, comment='密钥字符串'),
    sa.Column('url', mysql.TEXT(), nullable=False, comment='请求地址'),
    sa.Column('base_url', sa.String(length=255), nullable=False, comment='应用站点地址'),
    sa.Column('path', sa.String(length=255), nullable=False, comment='请求路径'),
    sa.Column('method', sa.String(length=10), nullable=False, comment='请求方式'),
    sa.Column('request_params', sa.Text(), nullable=True, comment='请求参数格式'),
    sa.Column('ip', sa.String(length=50), nullable=False, comment='IP地址'),
    sa.Column('port', sa.Integer(), nullable=False, comment='端口'),
    sa.Column('request_at', mysql.DATETIME(fsp=6), nullable=False, comment='请求时间(带时区，支持毫秒精度)'),
    sa.Column('response_json', mysql.LONGTEXT(), nullable=False, comment='响应格式'),
    sa.Column('response_time', sa.Float(), nullable=False, comment='响应时间'),
    sa.Column('status_code', sa.Integer(), nullable=False, comment='响应状态码'),
    sa.Column('created', mysql.DATETIME(fsp=6), nullable=False, comment='日志创建时间(带时区，支持毫秒精度)'),
    sa.Column('updated', mysql.DATETIME(fsp=6), nullable=False, comment='日志更新时间(带时区，支持毫秒精度)'),
    sa.Column('timestamp', mysql.DECIMAL(precision=16, scale=6), nullable=False, comment='时间戳'),
    sa.Column('is_deleted', sa.Integer(), nullable=False, comment='删除标示，0:未删除，1:已删除'),
    sa.PrimaryKeyConstraint('aid')
    )
    op.create_index(op.f('ix_interface_log_id'), 'interface_log', ['id'], unique=True)
    op.create_table('user',
    sa.Column('id', sa.String(length=50), nullable=False, comment='随机生成唯一id'),
    sa.Column('aid', sa.Integer(), autoincrement=True, nullable=False, comment='有序自增id，可用于游标分页'),
    sa.Column('created', sa.DateTime(), nullable=False),
    sa.Column('updated', sa.DateTime(), nullable=False),
    sa.Column('is_deleted', sa.Integer(), nullable=False),
    sa.Column('username', sa.String(length=50), nullable=False, comment='用户名'),
    sa.Column('role', sa.String(length=20), nullable=False, comment='用户角色'),
    sa.Column('avatar_url', sa.String(length=255), nullable=True, comment='头像URL'),
    sa.Column('age', sa.Integer(), nullable=True, comment='年龄'),
    sa.Column('gender', sa.String(length=10), nullable=True, comment='性别'),
    sa.Column('bio', sa.Text(), nullable=True, comment='描述'),
    sa.Column('last_login', sa.DateTime(), nullable=True, comment='最后登录时间'),
    sa.Column('is_online', sa.Boolean(), nullable=False, comment='在线状态'),
    sa.PrimaryKeyConstraint('aid'),
    sa.UniqueConstraint('username')
    )
    op.create_index(op.f('ix_user_id'), 'user', ['id'], unique=True)
    op.create_table('interface',
    sa.Column('id', sa.String(length=50), nullable=False, comment='随机生成唯一id'),
    sa.Column('aid', sa.Integer(), autoincrement=True, nullable=False, comment='有序自增id，可用于游标分页'),
    sa.Column('interface_name', sa.String(length=100), nullable=False, comment='接口名称'),
    sa.Column('path', sa.String(length=255), nullable=False, comment='请求路径'),
    sa.Column('method', sa.String(length=10), nullable=False, comment='请求方式'),
    sa.Column('request_params', sa.Text(), nullable=True, comment='请求参数格式'),
    sa.Column('response_json', sa.Text(), nullable=False, comment='响应格式'),
    sa.Column('version', sa.String(length=20), nullable=False, comment='版本号'),
    sa.Column('app_id', sa.String(length=50), nullable=False, comment='应用ID'),
    sa.Column('status', sa.Integer(), nullable=False, comment='接口状态，0:运行中，1:维护中，2:已停止'),
    sa.Column('remark', sa.String(length=500), nullable=True, comment='备注'),
    sa.Column('created', sa.DateTime(), nullable=False, comment='创建时间'),
    sa.Column('updated', sa.DateTime(), nullable=False, comment='更新时间'),
    sa.Column('is_deleted', sa.Integer(), nullable=False, comment='删除标示，0:未删除，1:已删除'),
    sa.ForeignKeyConstraint(['app_id'], ['app.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('aid')
    )
    op.create_index(op.f('ix_interface_id'), 'interface', ['id'], unique=True)
    op.create_table('interfaceauth',
    sa.Column('id', sa.String(length=50), nullable=False, comment='随机生成唯一id'),
    sa.Column('aid', sa.Integer(), autoincrement=True, nullable=False, comment='有序自增id，可用于游标分页'),
    sa.Column('api_key_id', sa.String(length=50), nullable=False, comment='密钥ID'),
    sa.Column('app_id', sa.String(length=50), nullable=False, comment='应用ID'),
    sa.Column('interface_id', sa.String(length=50), nullable=False, comment='接口ID'),
    sa.Column('created', sa.DateTime(), nullable=False, comment='创建时间'),
    sa.Column('updated', sa.DateTime(), nullable=False, comment='更新时间'),
    sa.Column('is_deleted', sa.Integer(), nullable=False, comment='删除标示，0:未删除，1:已删除'),
    sa.ForeignKeyConstraint(['api_key_id'], ['api_key.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['app_id'], ['app.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['interface_id'], ['interface.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('aid')
    )
    op.create_index(op.f('ix_interfaceauth_id'), 'interfaceauth', ['id'], unique=True)
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_interfaceauth_id'), table_name='interfaceauth')
    op.drop_table('interfaceauth')
    op.drop_index(op.f('ix_interface_id'), table_name='interface')
    op.drop_table('interface')
    op.drop_index(op.f('ix_user_id'), table_name='user')
    op.drop_table('user')
    op.drop_index(op.f('ix_interface_log_id'), table_name='interface_log')
    op.drop_table('interface_log')
    op.drop_index(op.f('ix_app_id'), table_name='app')
    op.drop_table('app')
    op.drop_index(op.f('ix_api_key_id'), table_name='api_key')
    op.drop_table('api_key')
    # ### end Alembic commands ###
