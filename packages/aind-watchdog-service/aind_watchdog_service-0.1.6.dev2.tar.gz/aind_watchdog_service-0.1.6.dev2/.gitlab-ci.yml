variables:
  ARTIFACT_PATH: dist/

  PY_VERSION: '3.11'
  # CONDA_SPECS: pip=24.2 setuptools=69.5.1


build:
    script:
        - python -m pip install -e . -i https://pypi.org/simple
        - python -m pip install --upgrade setuptools wheel twine build --extra-index-url https://pypi.org/simple
        - python -m build
        - twine check dist/*.gz dist/*.whl

        - python -m pip install -e .[service,publish] --extra-index-url https://pypi.org/simple
        - python build_watchdog.py

# Check that pyinstaller collected everything right and the executable runs
can_i_run_test:
  stage: test
  except:
      variables:
        - $CI_COMMIT_MESSAGE =~ /skip-ci/
  tags:
    - windows
    - python
 
  script:
    - timeout -k 1 60 $ARTIFACT_PATH//aind_watchdog_service.exe -v

# build_docs:
#   extends: build
#   stage: build
#   # before_script: 
#   script: 
#     - python -m pip install -r requirements_dev.txt
#     - sphinx-build -M html docs/sphinx/source/ public_html


include: 'http://eng-gitlab.corp.alleninstitute.org/infrastructure/mpeci/raw/master/resources/gitlab-ci-template.yml'